<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <title>PC-Manage</title>

  <script src="../js/jquery-1.11.2.min.js"></script>
  <script src="../js/base64.js"></script>
  <script src="../js/utf8.js"></script>

  <style>
    #devinfo_container {
      width: 260px;
      height: 100%;
    }

    .devinfo_center {
      position: absolute;
      left: 50%;
      margin-left: -130px;
    }
  </style>
</head>

<body>
  <div id="devinfo_container" class="devinfo_center">
    <br /><br />
    <table>
      <tr>
        <th><label>请注意,"清空客流量"设备将从0开始计数,丢失以前的数据:</label></th>
        <th align="right" width="150px"><input type="button" class="btn" value="清空客流量" id="reset_pc_btn" /></th>
      </tr>

      <tr>
        <th><br /></th>
        <th></th>
      </tr>
      <tr>
        <th><br /></th>
        <th></th>
      </tr>

      <tr>
        <th align="left"><label>有效时间段:</label></th>
        <th><label>例:09:30 22:00</label></th>
      </tr>

      <tr>
        <th align="left"><label>起始时间:</label></th>
        <th>
          <select id="bng_hour" style="width: 5em">
            <option>00</option>
            <option>01</option>
            <option>02</option>
            <option>03</option>
            <option>04</option>
            <option>05</option>
            <option>06</option>
            <option>07</option>
            <option>08</option>
            <option>09</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
            <option>13</option>
            <option>14</option>
            <option>15</option>
            <option>16</option>
            <option>17</option>
            <option>18</option>
            <option>19</option>
            <option>20</option>
            <option>21</option>
            <option>22</option>
            <option>23</option>
          </select>
          <select id="bng_min" style="width: 5em">
            <option>00</option>
            <option>01</option>
            <option>02</option>
            <option>03</option>
            <option>04</option>
            <option>05</option>
            <option>06</option>
            <option>07</option>
            <option>08</option>
            <option>09</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
            <option>13</option>
            <option>14</option>
            <option>15</option>
            <option>16</option>
            <option>17</option>
            <option>18</option>
            <option>19</option>
            <option>20</option>
            <option>21</option>
            <option>22</option>
            <option>23</option>
            <option>24</option>
            <option>25</option>
            <option>26</option>
            <option>27</option>
            <option>28</option>
            <option>29</option>
            <option>30</option>
            <option>31</option>
            <option>32</option>
            <option>33</option>
            <option>34</option>
            <option>35</option>
            <option>36</option>
            <option>37</option>
            <option>38</option>
            <option>39</option>
            <option>40</option>
            <option>41</option>
            <option>42</option>
            <option>43</option>
            <option>44</option>
            <option>45</option>
            <option>46</option>
            <option>47</option>
            <option>48</option>
            <option>49</option>
            <option>50</option>
            <option>51</option>
            <option>52</option>
            <option>53</option>
            <option>54</option>
            <option>55</option>
            <option>56</option>
            <option>57</option>
            <option>58</option>
            <option>59</option>
          </select>
        </th>
      </tr>

      <tr>
        <th align="left"><label>结束时间:</label></th>
        <th>
          <select id="end_hour" style="width: 5em">
            <option>00</option>
            <option>01</option>
            <option>02</option>
            <option>03</option>
            <option>04</option>
            <option>05</option>
            <option>06</option>
            <option>07</option>
            <option>08</option>
            <option>09</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
            <option>13</option>
            <option>14</option>
            <option>15</option>
            <option>16</option>
            <option>17</option>
            <option>18</option>
            <option>19</option>
            <option>20</option>
            <option>21</option>
            <option>22</option>
            <option>23</option>
          </select>
          <select id="end_min" style="width: 5em">
            <option>00</option>
            <option>01</option>
            <option>02</option>
            <option>03</option>
            <option>04</option>
            <option>05</option>
            <option>06</option>
            <option>07</option>
            <option>08</option>
            <option>09</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
            <option>13</option>
            <option>14</option>
            <option>15</option>
            <option>16</option>
            <option>17</option>
            <option>18</option>
            <option>19</option>
            <option>20</option>
            <option>21</option>
            <option>22</option>
            <option>23</option>
            <option>24</option>
            <option>25</option>
            <option>26</option>
            <option>27</option>
            <option>28</option>
            <option>29</option>
            <option>30</option>
            <option>31</option>
            <option>32</option>
            <option>33</option>
            <option>34</option>
            <option>35</option>
            <option>36</option>
            <option>37</option>
            <option>38</option>
            <option>39</option>
            <option>40</option>
            <option>41</option>
            <option>42</option>
            <option>43</option>
            <option>44</option>
            <option>45</option>
            <option>46</option>
            <option>47</option>
            <option>48</option>
            <option>49</option>
            <option>50</option>
            <option>51</option>
            <option>52</option>
            <option>53</option>
            <option>54</option>
            <option>55</option>
            <option>56</option>
            <option>57</option>
            <option>58</option>
            <option>59</option>
          </select>
        </th>
      </tr>

      <tr>
        <th></th>
        <th align="right"><input type="button" class="btn" value="设置有效时间段" id="set_valid_time" /></th>
      </tr>
    </table>
  </div>

  <script>
    jQuery.fn.select_val = function (value) {
      if (arguments.length) {
        if (this.children('option[value="' + value + '"]').length > 0) {
          this.val(value);
          // this.selectmenu("refresh");
        }
      }
      else {
        return this.val();
      }
    }

    function get_valid_time() {
      var req = {};
      req.cmd = 'get_pc_valid_time';
      req.id = 1;
      req.body = {};
      var jsonstr = JSON.stringify(req);

      $.ajax({
        type: 'POST',
        url: '/dispatch',
        dataType: 'text',
        data: jsonstr,
        success: function (ajaxdata) {
          var jresp = eval('(' + ajaxdata + ')');
          if (jresp.state == 200) {

            $('#bng_hour').select_val(jresp.body.bng_hour);
            $('#bng_min').select_val(jresp.body.bng_min);
            $('#end_hour').select_val(jresp.body.bng_hour);
            $('#end_min').select_val(jresp.body.bng_min);
          } else {
            alert('获取参数错误!');
          }
        }
      });
    }

    function set_valid_time() {
      var req = {};
      req.cmd = 'set_pc_valid_time';
      req.id = 1;
      req.body = {};
      req.body.bng_hour = parseInt($('#bng_hour').val());
      req.body.bng_min = parseInt($('#bng_min').val());
      req.body.end_hour = parseInt($('#end_hour').val());
      req.body.end_min = parseInt($('#end_min').val());

      var jsonstr = JSON.stringify(req);
      $.ajax({
        type: 'POST',
        url: '/dispatch',
        dataType: 'text',
        data: jsonstr,
        success: function (ajaxdata) {
          var jresp = eval('(' + ajaxdata + ')');
          if (jresp.state == 200) {
            alert('参数配置成功');
            get_valid_time();
          } else {
            alert('参数配置错误');
            get_valid_time();
          }
        },
      });
    }

    function reset_pcnum() {
      var req = {};
      req.cmd = 'reset_pcnum';
      req.id = 1;
      req.body = {};

      var jsonstr = JSON.stringify(req);
      $.ajax({
        type: 'POST',
        url: '/dispatch',
        dataType: 'text',
        data: jsonstr,
        success: function (ajaxdata) {
          var jresp = eval('(' + ajaxdata + ')');
          if (jresp.state == 200) {
            alert('清除计数成功');
          } else {
            alert('清除计数失败');
          }
        },
      });
    }

    $(document).ready(function () {
      $(window).ready(function () {
        get_valid_time();
      });

      $('#reset_pc_btn').click(function () {
        reset_pcnum();
      });

      $('#set_valid_time').click(function () {
        set_valid_time();
      });
    });
  </script>

</body>
</html>