<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>语言播报</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <script type="text/javascript" src="../js/LAB.min.js"></script>
    <style type="text/css">
        body {
            display: none;
        }
    </style>
    <script type="text/javascript">
        $LAB
        .script("../js/launch.js?version=" + new Date().getTime()).wait(function () {
            init(function () {                
                var g_broadcast_out = null;
                function get_oem01_broadcast_out() {
                    $.get("../vb.htm?getoem01audioout",
                    function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if ("OK" != ajaxdata.slice(0, 2)) return false;
                        var decode = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);                        
                        decode = decode.split(":");
                        g_broadcast_out = decode;

                        $("#check_broadcastip").check_val(decode[0] == 1);
                        $("#entrancebroadcasthead").select_val(decode[1]);
                        $("#exitbroadcasthead").select_val(decode[2]);
                        $("#check_broadcast_plateid").check_val(decode[3] == 1);
                        $("#check_broadcast_daysremain").check_val(decode[4] == 1);
                    });
                }

                function set_oem01_broadcast_out() {
                    var broadcast_out = Array();
                    broadcast_out[0] = $("#check_broadcastip").check_val() ? 1 : 0;
                    broadcast_out[1] = $("#entrancebroadcasthead").select_val();
                    broadcast_out[2] = $("#exitbroadcasthead").select_val();
                    broadcast_out[3] = $("#check_broadcast_plateid").check_val() ? 1 : 0;
                    broadcast_out[4] = $("#check_broadcast_daysremain").check_val() ? 1 : 0;

                    var changed = false;
                    for (var i = 0; i < 5; i++) {
                        if (g_broadcast_out == null || broadcast_out[i] != g_broadcast_out[i]) {
                            changed = true;
                            break;
                        }
                    }
                    if (!changed) return;

                    var data = broadcast_out[0];
                    for (var i = 1; i < 5; i++) {
                        data += ":";
                        data += broadcast_out[i];
                    }
                    data = Base64.encode(data);

                    $.get("../vb.htm?oem01audioout=" + data, function (ajaxdata) {
                        default_ajax_handler(ajaxdata);
                        get_oem01_broadcast_out();
                    });
                }

                var g_broadcast_volume;
                function get_oem01_broadcast_volume() {
                    $.get("../vb.htm?getoem01audiovolume",
                    function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if ("OK" != ajaxdata.slice(0, 2)) return false;
                        var decode = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                        g_broadcast_volume = decode;
                        decode = decode.split(":");

                        $("#check_time_period1_volume").check_val(decode[0] == 1);
                        $("#starthour1").select_val(decode[1]);
                        $("#startmin1").select_val(decode[2]);
                        $("#endhour1").select_val(decode[3]);
                        $("#endmin1").select_val(decode[4]);
                        $("#time_period1_volume_slider").slider("value", decode[5]);
                        $("#check_time_period2_volume").check_val(decode[6] == 1);
                        $("#starthour2").select_val(decode[7]);
                        $("#startmin2").select_val(decode[8]);
                        $("#endhour2").select_val(decode[9]);
                        $("#endmin2").select_val(decode[10]);
                        $("#time_period2_volume_slider").slider("value", decode[11]);
                        $("#other_volume_slider").slider("value", decode[12]);
                    });
                }

                function set_oem01_broadcast_volume() {
                    var broadcast_volume = Array();
                    broadcast_volume[0] = $("#check_time_period1_volume").check_val() ? 1 : 0;
                    broadcast_volume[1] = $("#starthour1").select_val();
                    broadcast_volume[2] = $("#startmin1").select_val();
                    broadcast_volume[3] = $("#endhour1").select_val();
                    broadcast_volume[4] = $("#endmin1").select_val();
                    broadcast_volume[5] = $("#time_period1_volume_slider").slider("value");
                    broadcast_volume[6] = $("#check_time_period2_volume").check_val() ? 1 : 0;
                    broadcast_volume[7] = $("#starthour2").select_val();
                    broadcast_volume[8] = $("#startmin2").select_val();
                    broadcast_volume[9] = $("#endhour2").select_val();
                    broadcast_volume[10] = $("#endmin2").select_val();
                    broadcast_volume[11] = $("#time_period2_volume_slider").slider("value");
                    broadcast_volume[12] = $("#other_volume_slider").slider("value");

                    var data = broadcast_volume[0];
                    for (var i = 1; i < 13; i++) {
                        data += ":";
                        data += broadcast_volume[i];
                    }
                    if (data == g_broadcast_volume) return;
                    data = Base64.encode(data);

                    $.get("../vb.htm?oem01audiovolume=" + data, function (ajaxdata) {
                        default_ajax_handler(ajaxdata);
                        get_oem01_broadcast_volume();
                    });
                }

                function get_broadcast_out_temporary() {
                    var cfg = {};
                    cfg.protocol_type = "get_charge_voice_config_request";
                    var jsonstr = JSON.stringify(cfg);
                    $.ajax({
                        type: "POST",
                        url: "../getopensdkrequest.php",
                        data: jsonstr,
                        success: function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            ajaxdata = ajaxdata.substring(ajaxdata.indexOf(" ") + 1);
                            var jsondata = eval("(" + ajaxdata + ")");
                            if (jsondata.response_state == 200) {
                                $("#entrancebroadcasthead_temporary").select_val(jsondata.entry_head_flag);
                                $("#exitbroadcasthead_temporary").select_val(jsondata.out_head_flag);
                                $("#check_broadcast_plateid_temporary").check_val(jsondata.plate_and_time_flag == 1);
                            }
                        },
                        dataType: "text"
                    });
                }
                
                function submit_broadcast_out_temporary() {
                    var cfg = {};
                    cfg.protocol_type = "set_charge_voice_config_request";
                    cfg.response_state = 200;
                    cfg.entry_head_flag = parseInt($("#entrancebroadcasthead_temporary").select_val());
                    cfg.out_head_flag = parseInt($("#exitbroadcasthead_temporary").select_val());
                    cfg.plate_and_time_flag = $("#check_broadcast_plateid_temporary").check_val() ? 1 : 0;

                    var jsonstr = JSON.stringify(cfg);
                    $.ajax({
                        type: "POST",
                        url: "../getopensdkrequest.php",
                        data: jsonstr,
                        success: function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            ajaxdata = ajaxdata.substring(ajaxdata.indexOf(" ") + 1);
                            var jsondata = eval("(" + ajaxdata + ")");
                            if (jsondata.response_state == 200) {
                                show_informer();
                                get_broadcast_out_temporary();
                            }
                        },
                        dataType: "text"
                    });
                }
                
                function init_slider(name) {
                    max = 7;
                    mid = 3
                    var slider_name = "#" + name + "_slider";
                    var text_name = "#" + name + "_text";
                    $(slider_name).slider({
                        range: "min",
                        value: mid,
                        min: 0,
                        max: max,
                        change: function (event, ui) {
                            $(text_name).html(ui.value);
                        },
                        slide: function (event, ui) {
                            $(text_name).html(ui.value);
                        },
                        stop: function (event, ui) {
                        }
                    });
                    $(text_name).html($(slider_name).slider("value"));
                }
                                
                $(function () {
                    init_selectmenu("#entrancebroadcasthead,#entrancebroadcasthead_temporary", 110, 150);
                    init_selectmenu("#exitbroadcasthead,#exitbroadcasthead_temporary", 110, 150);
                    init_selectmenu(".time_select", 60, 150);
                    init_slider("other_volume");
                    init_slider("time_period1_volume");
                    init_slider("time_period2_volume");                    
                    $("#submit_broadcast_out").click(set_oem01_broadcast_out);
                    get_oem01_broadcast_out();
                    $("#submit_broadcast_volume").click(set_oem01_broadcast_volume);
                    get_oem01_broadcast_volume();
                    $("#submit_broadcast_out_temporary").click(submit_broadcast_out_temporary);
                    get_broadcast_out_temporary();
                });
            });
        });
    </script>

</head>
<body>
    <div id="tabs">
        <ul>
            <li><a href="#tab1">固定车播报内容</a></li>
            <li><a href="#tab3">临时车播报内容</a></li>
            <li><a href="#tab2">音量控制</a></li>
        </ul>
        <div id="tab1">
            <table class="dummy" >
                <tr>
                    <td>
                        开机播报ip
                    </td>
                    <td>
                        <input id="check_broadcastip" type="checkbox" />
                        <label for="check_broadcastip">
                            开启
                        </label>
                    </td>
                </tr>                
                <tr>
                    <td >
                        入口语音头设置
                    </td>
                    <td >
                        <select id="entrancebroadcasthead">
                            <option value="0">你好</option>
                            <option value="1">欢迎光临</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        出口语音头设置
                    </td>
                    <td>
                        <select id="exitbroadcasthead">
                            <option value="0">一路平安</option>
                            <option value="1">一路顺风</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        播报车牌号码
                    </td>
                    <td>
                        <input id="check_broadcast_plateid" type="checkbox" />
                        <label for="check_broadcast_plateid">
                            开启
                        </label>
                    </td>
                </tr>
                <tr>
                    <td>
                        播报剩余天数
                    </td>
                    <td>
                        <input id="check_broadcast_daysremain" type="checkbox" />
                        <label for="check_broadcast_daysremain">
                            开启
                        </label>
                    </td>
                </tr>
                <tr>
                    <td colspan="4" align="right">
                        <input id="submit_broadcast_out" type="submit" value="确定" />
                    </td>
                </tr>
            </table>
        </div>
        <div id="tab3">
            <table class="dummy">
                <tr>
                    <td>
                        入口语音头设置
                    </td>
                    <td>
                        <select id="entrancebroadcasthead_temporary">
                            <option value="0">你好</option>
                            <option value="1">欢迎光临</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        出口语音头设置
                    </td>
                    <td>
                        <select id="exitbroadcasthead_temporary">
                            <option value="0">一路平安</option>
                            <option value="1">一路顺风</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        播报车牌及停车时间
                    </td>
                    <td>
                        <input id="check_broadcast_plateid_temporary" type="checkbox" />
                        <label for="check_broadcast_plateid_temporary">
                            开启
                        </label>
                    </td>
                </tr>
                <tr>
                    <td colspan="4" align="right">
                        <input id="submit_broadcast_out_temporary" type="submit" value="确定" />
                    </td>
                </tr>
            </table>
        </div>
        <div id="tab2">
            <table class="dummy" >
                <tr>
                    <td>
                        <input id="check_time_period1_volume" type="checkbox" />
                        <label for="check_time_period1_volume">
                            开启时间段1
                        </label>
                    </td>
                    <td>
                        <select id="starthour1" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                        </select>
                    </td>
                    <td>
                        时
                    </td>
                    <td>
                        <select id="startmin1" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                            <option value="32">32</option>
                            <option value="33">33</option>
                            <option value="34">34</option>
                            <option value="35">35</option>
                            <option value="36">36</option>
                            <option value="37">37</option>
                            <option value="38">38</option>
                            <option value="39">39</option>
                            <option value="40">40</option>
                            <option value="41">41</option>
                            <option value="42">42</option>
                            <option value="43">43</option>
                            <option value="44">44</option>
                            <option value="45">45</option>
                            <option value="46">46</option>
                            <option value="47">47</option>
                            <option value="48">48</option>
                            <option value="49">49</option>
                            <option value="50">50</option>
                            <option value="51">51</option>
                            <option value="52">52</option>
                            <option value="53">53</option>
                            <option value="54">54</option>
                            <option value="55">55</option>
                            <option value="56">56</option>
                            <option value="57">57</option>
                            <option value="58">58</option>
                            <option value="59">59</option>
                        </select>
                    </td>
                    <td>
                        分
                    </td>
                    <td>-</td>
                    <td>
                        <select id="endhour1" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                        </select>
                    </td>
                    <td>
                        时
                    </td>
                    <td>
                        <select id="endmin1" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                            <option value="32">32</option>
                            <option value="33">33</option>
                            <option value="34">34</option>
                            <option value="35">35</option>
                            <option value="36">36</option>
                            <option value="37">37</option>
                            <option value="38">38</option>
                            <option value="39">39</option>
                            <option value="40">40</option>
                            <option value="41">41</option>
                            <option value="42">42</option>
                            <option value="43">43</option>
                            <option value="44">44</option>
                            <option value="45">45</option>
                            <option value="46">46</option>
                            <option value="47">47</option>
                            <option value="48">48</option>
                            <option value="49">49</option>
                            <option value="50">50</option>
                            <option value="51">51</option>
                            <option value="52">52</option>
                            <option value="53">53</option>
                            <option value="54">54</option>
                            <option value="55">55</option>
                            <option value="56">56</option>
                            <option value="57">57</option>
                            <option value="58">58</option>
                            <option value="59">59</option>
                        </select>
                    </td>
                    <td>
                        分
                    </td>
                </tr>
                <tr>
                    <td>
                        音量大小
                    </td>
                    <td id="time_period1_volume_text"></td>
                    <td colspan="3">
                        <div id="time_period1_volume_slider" />
                    </td>
                </tr>
                <tr>
                    <td>
                        <input id="check_time_period2_volume" type="checkbox" />
                        <label for="check_time_period2_volume">
                            开启时间段2
                        </label>
                    </td>
                    <td>
                        <select id="starthour2" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                        </select>
                    </td>
                    <td>
                        时
                    </td>
                    <td>
                        <select id="startmin2" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                            <option value="32">32</option>
                            <option value="33">33</option>
                            <option value="34">34</option>
                            <option value="35">35</option>
                            <option value="36">36</option>
                            <option value="37">37</option>
                            <option value="38">38</option>
                            <option value="39">39</option>
                            <option value="40">40</option>
                            <option value="41">41</option>
                            <option value="42">42</option>
                            <option value="43">43</option>
                            <option value="44">44</option>
                            <option value="45">45</option>
                            <option value="46">46</option>
                            <option value="47">47</option>
                            <option value="48">48</option>
                            <option value="49">49</option>
                            <option value="50">50</option>
                            <option value="51">51</option>
                            <option value="52">52</option>
                            <option value="53">53</option>
                            <option value="54">54</option>
                            <option value="55">55</option>
                            <option value="56">56</option>
                            <option value="57">57</option>
                            <option value="58">58</option>
                            <option value="59">59</option>
                        </select>
                    </td>
                    <td>
                        分
                    </td>
                    <td>-</td>
                    <td>
                        <select id="endhour2" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                        </select>
                    </td>
                    <td>
                        时
                    </td>
                    <td>
                        <select id="endmin2" class="time_select">
                            <option value="0">00</option>
                            <option value="1">01</option>
                            <option value="2">02</option>
                            <option value="3">03</option>
                            <option value="4">04</option>
                            <option value="5">05</option>
                            <option value="6">06</option>
                            <option value="7">07</option>
                            <option value="8">08</option>
                            <option value="9">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                            <option value="32">32</option>
                            <option value="33">33</option>
                            <option value="34">34</option>
                            <option value="35">35</option>
                            <option value="36">36</option>
                            <option value="37">37</option>
                            <option value="38">38</option>
                            <option value="39">39</option>
                            <option value="40">40</option>
                            <option value="41">41</option>
                            <option value="42">42</option>
                            <option value="43">43</option>
                            <option value="44">44</option>
                            <option value="45">45</option>
                            <option value="46">46</option>
                            <option value="47">47</option>
                            <option value="48">48</option>
                            <option value="49">49</option>
                            <option value="50">50</option>
                            <option value="51">51</option>
                            <option value="52">52</option>
                            <option value="53">53</option>
                            <option value="54">54</option>
                            <option value="55">55</option>
                            <option value="56">56</option>
                            <option value="57">57</option>
                            <option value="58">58</option>
                            <option value="59">59</option>
                        </select>
                    </td>
                    <td>
                        分
                    </td>
                </tr>
                <tr>

                    <td>
                        音量大小
                    </td>
                    <td id="time_period2_volume_text"></td>
                    <td colspan="3">
                        <div id="time_period2_volume_slider" />
                    </td>
                </tr>
                <tr>

                    <td>
                        其他时间音量大小
                    </td>
                    <td id="other_volume_text"></td>
                    <td colspan="3">
                        <div id="other_volume_slider" />
                    </td>
                </tr>
                <tr>
                    <td colspan="12" align="right">
                        <input id="submit_broadcast_volume" type="submit" value="确定" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>
</html>
