<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>网络设置</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <script type="text/javascript" src="../js/LAB.min.js"></script>
    <style type="text/css">
        body {
            display: none;
        }
    </style>
    <script type="text/javascript">
        $LAB
        .script("../js/launch.js?version=" + new Date().getTime()).wait(function () {
            init(function () {
                var g_ip = null;
                var g_nm = null;
                var g_gw = null;
                var g_dns = null;
                var g_title = null;
                var loaded = true;

                function get_title() {
                    $.get("../vb.htm", { paratest: "title" }, function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if ("OK" != ajaxdata.slice(0, 2)) return false;
                        var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                        $("#title").val(Utf8.decode(Base64.decode(slicestring)));
                        g_title = $('#title').val();
                    });
                }

                function set_title() {
                    sfm_cur_obj = $(this);
                    var title = $('#title').val();
                    if (title.match(/[\/\\<>*:?|]{1}/)) {
                        alert("设备名中不能包含以下字符“\/\\<>*:?|”");
                        return false;
                    }
                    if (g_title != $('#title').val()) {
                        var titlenow = Base64.encode(Utf8.encode($('#title').val()));
                        $.get("../vb.htm", { title: titlenow }, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_title();
                        });
                    }
                }
                function get_server_netconfig() {
                    $.get("../vb.htm?getnetip&getnetmask&getgateway&getdnsip", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_ip = parse_ajax_data(response[0]);
                        g_nm = parse_ajax_data(response[1]);
                        g_gw = parse_ajax_data(response[2]);
                        g_dns = parse_ajax_data(response[3]);
                        $("#input_netip").val(g_ip);
                        $("#input_netmask").val(g_nm);
                        $("#input_gateway").val(g_gw);
                        $("#input_dnsip").val(g_dns);
                    });
                }

                var redirect_ip_timer = 0;
                var newloc = null;
                function redirect_ip_go() {
                    clearTimeout(redirect_ip_timer);
                    redirect_ip_timer = 0;
                    $('#warning_text').html("");
                    top.location.href = newloc;
                }
                function redirect_ip() {
                    hide_informer();
                    $("#warning_text").css("color", "Green");
                    $('#warning_text').html("ip地址已改变，正在跳转...");
                    if (redirect_ip_timer == 0) {
                        redirect_ip_timer = setTimeout(redirect_ip_go, 1000);
                    }
                }

                function redirect_http_port() {
                    hide_informer();
                    $("#warning_text").css("color", "Green");
                    $('#warning_text').html("http端口已改变，正在跳转...");
                    if (redirect_ip_timer == 0) {
                        redirect_ip_timer = setTimeout(redirect_ip_go, 5000);
                    }
                }

                function redirect_rtsp_go() {
                    clearTimeout(redirect_rtsp_timer);
                    redirect_rtsp_timer = 0;
                    $('#warning_text').html("");
                }
                var redirect_rtsp_timer = 0;
                function redirect_rtsp_port() {
                    hide_informer();
                    $("#warning_text").css("color", "Green");
                    $('#warning_text').html("rtsp端口已改变，可能需要重新登录!");
                    if (redirect_rtsp_timer == 0) {
                        redirect_rtsp_timer = setTimeout(redirect_rtsp_go, 2500);
                    }
                }

                function set_sever_netconfig() {
                    var map = {};
                    var send = false;
                    var ip = $("#input_netip").val();
                    var netmask = $("#input_netmask").val();
                    var gw = $("#input_gateway").val();
                    var dns = $("#input_dnsip").val();
                    if (!test_ip(ip)) {
                        alert("请输入正确的IP地址！");
                        return false;
                    }
                    if (!test_ip(netmask)) {
                        alert("请输入正确的子网掩码地址！");
                        return false;
                    }
                    if (!test_ip(gw)) {
                        alert("请输入正确的网关地址！");
                        return false;
                    }
                    if (!test_ip(dns)) {
                        alert("请输入正确的DNS地址！");
                        return false;
                    }

                    if (test_ip_netmask(ip, netmask)) {
                        return false;
                    }
                    if (test_gateway(gw)) {
                        return false;
                    }

                    if (ip != g_ip || netmask != g_nm || gw != g_gw || dns != g_dns) {
                        send = true;
                    }
                    var ipchanged = ip != g_ip;
                    var netmaskchanged = netmask != g_nm;

                    map.netip = ip;
                    map.netmask = netmask;
                    map.gateway = gw;
                    map.dnsip = dns;
                    if (send) {
                        $.get("../vb.htm", map, function (ajaxdata) {
                            //alert(ajaxdata);
                            default_ajax_handler(ajaxdata);
                            get_server_netconfig();
                        });
                        if (ipchanged) {
                            var new_href = top.location.href;
                            var realserver = new_href.split('/');
                            realserver = realserver[realserver.length - 2];
                            realserver = realserver.split(':')[0];
                            newloc = new_href.split(realserver);
                            newloc = newloc[0] + map.netip + newloc[1];
                            redirect_ip();
                        }
                    }
                    else {
                        //alert("没有设定任何值网络参数");
                    }
                }

                var g_http_port = null;
                var g_rtsp_port = null;
                function get_http_port() {
                    $.get("../vb.htm", { paratest: "httpport" }, function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_http_port = parse_ajax_data(response[0]);
                        $("#http_port").val(g_http_port);
                    });
                }

                function set_http_port() {
                    var http_port = parseInt($('#http_port').val());
                    if (isNaN(http_port) || (http_port < 1024 && http_port != 80) || http_port > 65535) {
                        alert("请输入正确的端口号！");
                        return false;
                    }

                    if (http_port == 49152 || http_port == 8000 || http_port == 8131 || http_port == 5291 || http_port == 5294 || http_port == 5295 || http_port == 2705 || http_port == 5566 || http_port == 5567 || http_port == g_rtsp_port) {
                        alert("该端口已被占用，请使用其他端口！");
                        return false;
                    }

                    if (g_http_port != http_port) {
                        $.get("../vb.htm", { httpport: http_port }, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_http_port();
                        });
                        var new_href = top.location.href;
                        var realserver = new_href.split('/');
                        realserver = realserver[realserver.length - 2];
                        var addr = realserver.split(':')[0];
                        newloc = new_href.split(realserver);
                        var port;
                        if (http_port == 80) port = '';
                        else port = ':' + http_port;
                        newloc = newloc[0] + addr + port;
                        redirect_http_port();
                    }
                }

                function get_rtsp_port() {
                    $.get("../vb.htm", { paratest: "rtspport" }, function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_rtsp_port = parse_ajax_data(response[0]);
                        $("#rtsp_port").val(g_rtsp_port);
                    });
                }

                function set_rtsp_port() {
                    var rtsp_port = parseInt($('#rtsp_port').val());
                    if (isNaN(rtsp_port) || (rtsp_port < 1024) || rtsp_port > 65535) {
                        alert("请输入正确的端口号！");
                        return false;
                    }

                    if (rtsp_port == 49152 || rtsp_port == 8000 || rtsp_port == 8131 || rtsp_port == 5291 || rtsp_port == 5294 || rtsp_port == 5295 || rtsp_port == 2705 || rtsp_port == 5566 || rtsp_port == 5567 || rtsp_port == g_http_port) {
                        alert("该端口已被占用，请使用其他端口！");
                        return false;
                    }

                    if (g_rtsp_port != rtsp_port) {
                        $.get("../vb.htm", { rtspport: rtsp_port }, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_rtsp_port();
                            redirect_rtsp_port();
                        });
                    }
                }

                var old_centerserver_tab = new function () {

                    var g_centerserver_hostname = null;
                    var g_centerserver_port = null;
                    var g_centerserver_enable = null;
                    function get_center_server() {
                        $.get("../vb.htm?paratest=getcenterserver", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            var decode = Base64.decode(slicestring);
                            decode = decode.split(":");
                            $("#centerserver_hostname").val(decode[0]);
                            $("#centerserver_port").val(decode[1]);
                            $("#centerserver_enable").checkBox('changeCheckStatus', decode[2] == 1);
                            g_centerserver_hostname = decode[0];
                            g_centerserver_port = decode[1];
                            g_centerserver_enable = decode[2];
                        });
                    }

                    function set_center_server() {
                        var hostname = $("#centerserver_hostname").val();
                        var port = $("#centerserver_port").val();
                        var enable = $("#centerserver_enable").is(':checked') ? "1" : "0";
                        if (hostname != g_centerserver_hostname || port != g_centerserver_port || enable != g_centerserver_enable) {
                            var data = hostname + ":" + port + ":" + enable;
                            var base64 = Base64.encode(data);
                            $.get("../vb.htm?setcenterserver=" + base64, function (ajaxdata) {
                                default_ajax_handler(ajaxdata);
                                get_center_server();
                            });
                        }
                    }
                    this.init = function () {
                        $("#centerserver_view_log").hide();
                        $("#tr_centerserver_ssl_enable").hide();
                        $("#tr_centerserver_ssl_port").hide();
                        $("#tr_centerserver_timeout").hide();
                        $("#tr_centerserver_device_reg_enable").hide();
                        $("#tr_centerserver_device_reg_uri").hide();
                        $("#tr_centerserver_plate_enable").hide();
                        $("#tr_centerserver_plate_uri").hide();
                        $("#tr_centerserver_plate_content_level").hide();
                        $("#tr_centerserver_plate_send_image").hide();
                        $("#tr_centerserver_plate_send_small_image").hide();
                        $("#tr_centerserver_gioin_enable").hide();
                        $("#tr_centerserver_gioin_uri").hide();
                        $("#tr_centerserver_gioin_io").hide();
                        $("#tr_centerserver_serial_enable").hide();
                        $("#tr_centerserver_serial_uri").hide();
                        $("#tr_centerserver_enable_old").show();
                        $("#centerserver_submit").click(function () {
                            set_center_server();
                        });
                        get_center_server();
                    }

                }

                var centerserver_tab = new function () {

                    var g_centerserver_hostname = null;
                    var g_centerserver_port = null;
                    var g_centerserver_enable_ssl = null;
                    var g_centerserver_ssl_port = null;
                    var g_centerserver_timeout = null;
                    var g_centerserver_enable = null;
                    var g_centerserver_device_reg_uri = null;
                    var g_centerserver_plate_enable = null;
                    var g_centerserver_plate_uri = null;
                    var g_centerserver_plateResultLevel = null;
                    var g_centerserver_bSendImage = null;
                    var g_centerserver_bSendSmallImage = null;
                    var g_centerserver_gioin_enable = null;
                    var g_centerserver_gioin_uri = null;
                    var g_centerserver_serial_enable = null;
                    var g_centerserver_serial_uri = null;

                    function get_center_server_net() {
                        $.get("../vb.htm?paratest=getcenterserver", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            var decode = Base64.decode(slicestring);
                            decode = decode.split(":");
                            $("#centerserver_hostname").val(decode[0]);
                            $("#centerserver_port").val(decode[1]);
                            $("#centerserver_enable_ssl").check_val(decode[2] == 1);
                            $("#centerserver_ssl_port").val(decode[3]);
                            $("#centerserver_timeout").val(decode[4]);

                            g_centerserver_hostname = decode[0];
                            g_centerserver_port = decode[1];
                            g_centerserver_enable_ssl = decode[2];
                            g_centerserver_ssl_port = decode[3];
                            g_centerserver_timeout = decode[4];
                        });
                    }

                    function set_center_server_net() {
                        var hostname = $("#centerserver_hostname").val();
                        var port = $("#centerserver_port").val();
                        var enable_ssl = $("#centerserver_enable_ssl").check_val() ? "1" : "0";
                        var ssl_port = $("#centerserver_ssl_port").val();
                        var timeout = $("#centerserver_timeout").val();
                        if (isNaN(port)) {
                            alert("服务器端口设置错误!");
                            return false;
                        }
                        if (isNaN(ssl_port)) {
                            alert("SSL端口设置错误!");
                            return false;
                        }
                        if (isNaN(timeout)) {
                            alert("超时时间设置错误!");
                            return false;
                        }
                        if (timeout <= 0 || timeout > 30) {
                            alert("超时时间设置错误,范围【1~30】");
                            return false;
                        }
                        if (hostname != g_centerserver_hostname || port != g_centerserver_port || enable_ssl != g_centerserver_enable_ssl || ssl_port != g_centerserver_ssl_port
                            || timeout != g_centerserver_timeout) {
                            var data = hostname + ":" + port + ":" + enable_ssl + ":" + ssl_port + ":" + timeout;
                            var base64 = Base64.encode(data);
                            $.get("../vb.htm?setcenterserver=" + base64, function (ajaxdata) {
                                default_ajax_handler(ajaxdata);
                                get_center_server_net();
                            });
                        }
                    }
                    //////////////////
                    function get_center_server_device_reg() {
                        $.get("../vb.htm?paratest=csdevicereg", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            var decode = Base64.decode(slicestring);
                            decode = decode.split(":");
                            if (decode[0] == 1) {
                                $("#centerserver_device_reg_enable2").check_val(true);
                            } else if (decode[0] == 2) {
                                $("#centerserver_device_reg_enable3").check_val(true);
                            }else{
                                $("#centerserver_device_reg_enable1").check_val(true);
                            }
                            //$("#centerserver_device_reg_enable").check_val(decode[0] == 1);
                            $("#centerserver_device_reg_uri").val(decode[1]);

                            g_centerserver_enable = decode[0];
                            g_centerserver_device_reg_uri = decode[1];
                        });
                    }

                    function set_center_server_device_reg() {
                        //var enable = $("#centerserver_device_reg_enable").check_val() ? "1" : "0";
                        var enable = 0;
                        if ($("#centerserver_device_reg_enable2").check_val()) {
                            enable = 1;
                        } else if ($("#centerserver_device_reg_enable3").check_val()) {
                            enable = 2;
                        } else {
                            enable = 0;
                        }
                        var centerserver_device_reg_uri = $("#centerserver_device_reg_uri").val();

                        if (enable != g_centerserver_enable || centerserver_device_reg_uri != g_centerserver_device_reg_uri) {
                            var data = enable + ":" + centerserver_device_reg_uri;
                            var base64 = Base64.encode(data);
                            $.get("../vb.htm?setcsdevicereg=" + base64, function (ajaxdata) {
                                default_ajax_handler(ajaxdata);
                                get_center_server_device_reg();
                            });
                        }
                    }
                    //////////////////////
                    function get_center_server_plate() {
                        $.get("../vb.htm?paratest=csalarmplateresult", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            var decode = Base64.decode(slicestring);
                            decode = decode.split(":");
                            $("#centerserver_plate_enable").check_val(decode[0] == 1);
                            $("#centerserver_plate_uri").val(decode[1]);
                            $("#centerserver_plate_content_level").select_val(decode[2]);
                            $("#centerserver_plate_send_image").check_val(decode[3] == 1);
                            $("#centerserver_plate_send_small_image").check_val(decode[4] == 1);

                            g_centerserver_plate_enable = decode[0];
                            g_centerserver_plate_uri = decode[1];
                            g_centerserver_plateResultLevel = decode[2];
                            g_centerserver_bSendImage = decode[3];
                            g_centerserver_bSendSmallImage = decode[4];
                        });
                    }

                    function set_center_server_plate() {
                        var centerserver_plate_enable = $("#centerserver_plate_enable").check_val() ? "1" : "0";
                        var centerserver_plate_uri = $("#centerserver_plate_uri").val();
                        var plateResultLevel = $("#centerserver_plate_content_level").select_val();
                        var bSendImage = $("#centerserver_plate_send_image").check_val() ? "1" : "0";
                        var bSendSmallImage = $("#centerserver_plate_send_small_image").check_val() ? "1" : "0";

                        if (centerserver_plate_uri != g_centerserver_plate_uri
                            || centerserver_plate_enable != g_centerserver_plate_enable
                            || plateResultLevel != g_centerserver_plateResultLevel
                            || bSendImage != g_centerserver_bSendImage
                            || bSendSmallImage != g_centerserver_bSendSmallImage) {
                            var data = centerserver_plate_enable + ":" + centerserver_plate_uri + ":" + plateResultLevel + ":" + bSendImage + ":" + bSendSmallImage;
                            var base64 = Base64.encode(data);
                            $.get("../vb.htm?setcsplateresult=" + base64, function (ajaxdata) {
                                default_ajax_handler(ajaxdata);
                                get_center_server_plate();
                            });
                        }
                    }
                    ////////////////
                    function get_center_server_gioin() {
                        $.get("../vb.htm?paratest=csalarmgioin", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            var decode = Base64.decode(slicestring);
                            decode = decode.split(":");
                            $("#centerserver_gioin_enable").check_val(decode[0] == 1);
                            $("#centerserver_gioin_uri").val(decode[1]);

                            g_centerserver_gioin_enable = decode[0];
                            g_centerserver_gioin_uri = decode[1];
                        });
                    }

                    function set_center_server_gioin() {
                        var centerserver_gioin_enable = $("#centerserver_gioin_enable").check_val() ? "1" : "0";
                        var centerserver_gioin_uri = $("#centerserver_gioin_uri").val();

                        if (centerserver_gioin_enable != g_centerserver_gioin_enable || centerserver_gioin_uri != g_centerserver_gioin_uri) {
                            var data = centerserver_gioin_enable + ":" + centerserver_gioin_uri;
                            var base64 = Base64.encode(data);
                            $.get("../vb.htm?setcsgioin=" + base64, function (ajaxdata) {
                                default_ajax_handler(ajaxdata);
                                get_center_server_gioin();
                            });
                        }
                    }
                    //////////////////
                    function get_center_server_serial() {
                        $.get("../vb.htm?paratest=csserial", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            var decode = Base64.decode(slicestring);
                            decode = decode.split(":");
                            $("#centerserver_serial_enable").check_val(decode[0] == 1);
                            $("#centerserver_serial_uri").val(decode[1]);

                            g_centerserver_serial_enable = decode[0];
                            g_centerserver_serial_uri = decode[1];
                        });
                    }

                    function set_center_server_serial() {
                        var centerserver_serial_enable = $("#centerserver_serial_enable").check_val() ? "1" : "0";
                        var centerserver_device_reg_uri = $("#centerserver_serial_uri").val();

                        if (centerserver_serial_enable != g_centerserver_serial_enable
                            || centerserver_device_reg_uri != g_centerserver_serial_uri) {
                            var data = centerserver_serial_enable + ":" + centerserver_device_reg_uri;
                            var base64 = Base64.encode(data);
                            $.get("../vb.htm?setcsserial=" + base64, function (ajaxdata) {
                                default_ajax_handler(ajaxdata);
                                get_center_server_serial();
                            });
                        }
                    }

                    function get_center_server_io(){
                        $.get("../vb.htm", { paratest: "gethttpgpio" }, function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            ajaxdata = ajaxdata.split("=")[1];
                            var jsondata = eval("(" + ajaxdata + ")");
                            if (jsondata.IO) {
                                var arr = jsondata.IO;
                                for (var i = 0; i < arr.length; i++) {
                                    $("#io" + (i+1)).check_val(arr[i] == 1);
                                }
                            }
                        });
                    }

                    function set_center_server_io() {
                        var arr = [];
                        $("#io_ul input[type='checkbox']").each(function (i,obj) {
                            var io = $(obj).is(":checked") ? 1 : 0;
                            arr.push(io);
                        });
                        var req = {};
                        req.IO = arr;
                        var jsonstr = JSON.stringify(req);

                        $.get("../vb.htm?sethttpgpio=" + jsonstr, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                        });
                    }
                    var g_centerserver_hostname_alt;
                    function get_centerserver_hostname_alt() {
                        $.get("../vb.htm?getcenterserverext", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var centerserver_hostname_alt = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            var data_json;
                            try {
                                data_json = eval("(" + centerserver_hostname_alt + ")");
                            }
                            catch (e) {
                                return;
                            }
                            var ip_ext = "";
                            var IP_Ext_arr = data_json.IpExt;
                            for (var i = 0; i < IP_Ext_arr.length;i++) {
                                if (ip_ext != "") {
                                    ip_ext += ";";
                                }
                                ip_ext += IP_Ext_arr[i].ipext;
                            }
                            g_centerserver_hostname_alt = ip_ext;
                            $("#centerserver_hostnamea_alt").val(ip_ext);
                        });
                    }

                    function test_add(ip) {
                        var reg = /[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/;
                        return reg.test(ip);
                    }
                    function set_centerserver_hostname_alt() {
                        var centerserver_hostnamea_alt = $("#centerserver_hostnamea_alt").val();
                        if (g_centerserver_hostname_alt == centerserver_hostnamea_alt) {
                            return;
                        }
                        var json_data = {}
                        json_data.IpExt = [];
                        if (centerserver_hostnamea_alt != "") {
                            var ip_error = false;
                            var ip_arr = centerserver_hostnamea_alt.split(";");
                            for (var i = 0; i < ip_arr.length; i++) {
                                if (!test_add(ip_arr[i])) {
                                    alert("备选服务器地址不正确！");
                                    ip_error = true;
                                    break;
                                } else {
                                    var json = {};
                                    json.ipext = ip_arr[i];
                                    json_data.IpExt.push(json);
                                }
                            }
                            if (ip_error) {
                                return;
                            }
                        }
                        var jsonstr = JSON.stringify(json_data);
                        $.get("../vb.htm?setcenterserverext=" + jsonstr, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_centerserver_hostname_alt();
                        });
                    }

                    function gethttpofflinestatus() {
                        $.get("../vb.htm?gethttpofflinestatus", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var httpofflinestatus = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            $("#http_offline_enable").check_val(httpofflinestatus == 1);
                        });
                    }

                    function sethttpofflinestatus() {
                        var httpofflinestatus = $("#http_offline_enable").check_val() ? "1" : "0";
                        $.get("../vb.htm?sethttpofflinestatus=" + httpofflinestatus, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            gethttpofflinestatus();
                        });
                    }

                    function gethttpserverpollstatus() {
                        $.get("../vb.htm?gethttpserverpollstatus", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var httppollstatus = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            $("#http_poll_enable").check_val(httppollstatus == 1);
                        });
                    }

                    function sethttpserverpollstatus() {
                        var httppollstatus = $("#http_poll_enable").check_val() ? "1" : "0";
                        $.get("../vb.htm?sethttpserverpollstatus=" + httppollstatus, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            gethttpserverpollstatus();
                        });
                    }

                    function gethttprepushnums() {
                        $.get("../vb.htm?gethttprepushnums", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            if ("OK" != ajaxdata.slice(0, 2)) return false;
                            var httprepushnums = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                            $("#httprepushnums_sel").select_val(httprepushnums);
                        });
                    }

                    function sethttprepushnums() {
                        var httprepushnums = $("#httprepushnums_sel").select_val();
                        $.get("../vb.htm?sethttprepushnums=" + httprepushnums, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            gethttprepushnums();
                        });
                    }

                    var cur_page = null;
                    var max_page = null;
                    var max_count = null;
                    var show_center_log = false;

                    function show_center_server_log() {
                        if (!show_center_log) {
                            show_center_log = true;
                            $("#centerserver_view_log").val("隐藏日志");
                            $(".center_log_items").show();
                            refresh_center_server_log();
                            $("#hostnamea_alt_hint").hide();
                        }
                        else {
                            show_center_log = false;
                            $("#centerserver_view_log").val("查看日志");
                            $(".center_log_items").hide();
                            $("#hostnamea_alt_hint").show();
                        }
                    }

                    function show_page_hint() {
                        if (cur_page != null) {
                            $("#log_page_hint").html("第" + cur_page + "/" + max_page + "页");
                        }
                    }

                    function refresh_center_server_log() {
                        get_center_server_log(true);
                    }

                    function get_center_server_log(refresh) {
                        if (!show_center_log) return;

                        $.get("../vb.htm?getcenterserverlogcount", function (ajaxdata) {
                            if (precheck(ajaxdata)) {
                                return false;
                            }
                            max_count = parseInt(parse_ajax_data(ajaxdata), 10);
                            var last_page_count = max_count % 50;
                            if (last_page_count != 0) max_page = parseInt(max_count / 50, 10);
                            else max_page = parseInt(max_count / 50 - 1, 10);
                            if (refresh || cur_page == null) {
                                cur_page = max_page;
                            }
                            show_page_hint();
                            $.get("../vb.htm?getcenterserverlog=" + cur_page * 50 + ":" + (cur_page * 50 + 50), function (ajaxdata) {
                                if (precheck(ajaxdata)) {
                                    return false;
                                }
                                if ("OK" != ajaxdata.slice(0, 2)) return false;
                                var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                                slicestring = slicestring.replace(/\n/g, "<br/>");
                                $("#log_content").html(slicestring);
                                if (refresh) {
                                    $('#log_content').scrollTop($('#log_content')[0].scrollHeight);
                                }
                            });
                        });
                    }

                    function log_next_page() {
                        if (cur_page != null && cur_page < max_page) {
                            cur_page++;
                            get_center_server_log(false);
                        }
                    }

                    function log_pre_page() {
                        if (cur_page != null && cur_page != 0) {
                            cur_page--;
                            get_center_server_log(false);
                        }
                    }

                    function log_goto_page() {
                        var page = parseInt($("#log_page_goto").val());
                        if (isNaN(page) || page < 0 || page > max_page) {
                            alert("请输入正确的页码！");
                            return;
                        }
                        cur_page = page;
                        get_center_server_log(false);
                    }

                    this.init = function () {
                        get_device_type();
                        if (g_device_type == 11) {
                            //一体机
                            $("#centerserver_submit").click(function () {
                                sfm_cur_obj = $(this);
                                set_center_server_net();
                                set_center_server_device_reg();
                                set_center_server_plate();
                                set_center_server_gioin();
                                set_center_server_serial();
                                //set_center_server_io();
                                set_centerserver_hostname_alt();
                                sethttpofflinestatus();
                                sethttpserverpollstatus();
                                sethttprepushnums();
                            });

                            $("#centerserver_view_log").click(show_center_server_log);
                            $("#log_refresh").click(refresh_center_server_log);
                            $("#log_page_goto_sub").click(log_goto_page);
                            $("#log_pre_page").click(log_pre_page);
                            $("#log_next_page").click(log_next_page);

                            get_center_server_net();
                            get_center_server_device_reg();
                            get_center_server_plate();
                            get_center_server_gioin();
                            get_center_server_serial();
                            //get_center_server_io();
                            get_centerserver_hostname_alt();
                            gethttpofflinestatus();
                            gethttpserverpollstatus();
                            gethttprepushnums();
                        }
                        else {
                            old_centerserver_tab.init();
                        }
                    }
                }

                var g_openvpn_hostname = null;
                var g_openvpn_port = null;
                var g_openvpn_enable = null;
                function get_openvpn() {
                    $.get("../vb.htm?paratest=getopenvpn", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if ("OK" != ajaxdata.slice(0, 2)) return false;
                        var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                        var decode = Base64.decode(slicestring);
                        decode = decode.split(":");
                        $("#openvpn_hostname").val(decode[0]);
                        $("#openvpn_port").val(decode[1]);
                        $("#openvpn_enable").check_val(decode[2] == 1);
                        g_openvpn_hostname = decode[0];
                        g_openvpn_port = decode[1];
                        g_openvpn_enable = decode[2];
                    });
                }

                function set_openvpn() {
                    sfm_cur_obj = $(this);
                    var hostname = $("#openvpn_hostname").val();
                    var port = $("#openvpn_port").val();
                    var enable = $("#openvpn_enable").check_val() ? "1" : "0";
                    if ($("#openvpn_status").val() == "已连接") {
                        if (hostname != g_openvpn_hostname || port != g_openvpn_port || enable != g_openvpn_enable) {
                            var data = hostname + ":" + port + ":" + enable;
                            var base64 = Base64.encode(data);
                            $.get("../vb.htm?setopenvpn=" + base64, function (ajaxdata) {
                                default_ajax_handler(ajaxdata);
                                get_openvpn();
                            });
                        }
                    }else{
                        var data = hostname + ":" + port + ":" + enable;
                        var base64 = Base64.encode(data);
                        $.get("../vb.htm?setopenvpn=" + base64, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_openvpn();
                        });
                    }
                }

                var g_upnp_enable = null;
                var g_upnp_httpport = null;
                var g_unpn_rtspport = null;

                function get_upnp_portmap() {
                    $.get("../vb.htm?paratest=upnpportmap", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if ("OK" != ajaxdata.slice(0, 2)) return false;
                        var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                        var decode = Base64.decode(slicestring);
                        decode = decode.split(":");
                        $("#upnp_enable").check_val(decode[0] == 1);
                        $("#upnp_http_port").val(decode[1]);
                        $("#upnp_rtst_port").val(decode[2]);

                        g_upnp_enable = decode[0];
                        g_upnp_httpport = decode[1];
                        g_unpn_rtspport = decode[2];
                    });
                }

                function set_upnp_portmap() {
                    sfm_cur_obj = $(this);
                    var upnp_enable = $("#upnp_enable").check_val() ? "1" : "0";
                    var upnp_httpport = $("#upnp_http_port").val();
                    var upnp_rtspport = $("#upnp_rtst_port").val();

                    if (upnp_enable != g_upnp_enable || upnp_httpport != g_upnp_httpport || upnp_rtspport != g_unpn_rtspport) {
                        var data = upnp_enable + ":" + upnp_httpport + ":" + upnp_rtspport;
                        var base64 = Base64.encode(data);
                        $.get("../vb.htm?setupnpportmap=" + base64, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_upnp_portmap();
                        });
                    }
                }

                var g_ddns_enable = null;
                var g_ddns_brand = null;
                var g_ddns_name = null;
                var g_ddns_user = null;
                var g_ddns_pass = null;

                function get_ddns() {
                    $.get("../vb.htm?paratest=ddns", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if ("OK" != ajaxdata.slice(0, 2)) return false;
                        var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                        var decode = Base64.decode(slicestring);
                        decode = decode.split(":");
                        $("#ddns_enable").check_val(decode[0] == 1);                       
                        $("#ddns_brand").select_val(decode[1]);

                        $("#ddns_name").val(decode[2]);
                        $("#ddns_user").val(decode[3]);
                        $("#ddns_pass").val(decode[4]);

                        g_ddns_enable = decode[0];
                        g_ddns_brand = decode[1];
                        g_ddns_name = decode[2];
                        g_ddns_user = decode[3];
                        g_ddns_pass = decode[4];
                    });
                }

                function set_ddns() {
                    sfm_cur_obj = $(this);
                    var ddns_enable = $("#ddns_enable").check_val() ? "1" : "0";
                    var ddns_brand = $("#ddns_brand").select_val();
                    var ddns_name = $("#ddns_name").val();
                    var ddns_user = $("#ddns_user").val();
                    var ddns_pass = $("#ddns_pass").val();

                    if (ddns_enable != g_ddns_enable || ddns_brand != g_ddns_brand
                        || ddns_name != g_ddns_name || ddns_user != g_ddns_user || ddns_pass != g_ddns_pass) {
                        var data = ddns_enable + ":" + ddns_brand + ":" + ddns_name
                                    + ":" + ddns_user + ":" + ddns_pass;
                        var base64 = Base64.encode(data);
                        $.get("../vb.htm?setddns=" + base64, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_ddns();
                        });
                    }
                }

                var g_ftp_ip = null;
                var g_ftp_port = null;
                var g_ftp_user = null;
                var g_ftp_pass = null;
                var g_ftp_path = null;
				var g_enableftp = null;
				function get_ftpenable()
				{
					$.get("../vb.htm?paratest=getalarmcfg.1", function(ajaxdata){
					 if(precheck(ajaxdata))
		             {
		                return false;
		             }
		            if("OK" != ajaxdata.slice(0,2)) return false;
		            var slicestring = ajaxdata.slice(ajaxdata.indexOf("=")+1,ajaxdata.length-1);
					var response = slicestring.split(";");
					response = response[0].split(":");
					g_enableftp = Number(response[1]);
					$("#ftp_enable").check_val(g_enableftp==1); 
					});
				}
				
				function set_ftpenable()
				{
				    var enable = $("#ftp_enable").check_val()? "1" : "0";
					if(enable == g_enableftp)
						return false;
						
					var data = "0:" + enable + ":0:0:0:500:3";
					$.get("../vb.htm?setalarmconfig=" + data + ".0", function(ajaxdata){
						default_ajax_handler(ajaxdata);
						g_enableftp = enable;
					});
				}

                function get_ftp() {
                    $.get("../vb.htm?paratest=ftpip&paratest=ftpipport&paratest=ftpuser&paratest=ftppassword&paratest=ftppath",
                    function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_ftp_ip = parse_ajax_data(response[0]);
                        g_ftp_port = parse_ajax_data(response[1]);
                        g_ftp_user = parse_ajax_data(response[2]);
                        g_ftp_pass = parse_ajax_data(response[3]);
                        g_ftp_path = parse_ajax_data(response[4]);
                        $("#ftp_ip").val(g_ftp_ip);
                        $("#ftp_port").val(g_ftp_port);
                        $("#ftp_user").val(g_ftp_user);
                        $("#ftp_pass").val(g_ftp_pass);
                        $("#ftp_path").val(g_ftp_path);
                    });
                }

                function set_ftp() {
                    sfm_cur_obj = $(this);
                    var ftp_ip = $("#ftp_ip").val();
                    var ftp_port = $("#ftp_port").val();
                    var ftp_user = $("#ftp_user").val();
                    var ftp_pass = $("#ftp_pass").val();
                    var ftp_path = $("#ftp_path").val();
                    var reg_str = /^[a-zA-Z0-9_\u4e00-\u9fa5]+$/;
                    if (!reg_str.test(ftp_path)) {
                        alert("上传路径只能包含：汉字、字母、数字、下划线");
                        return;
                    }

                    if (ftp_ip != g_ftp_ip || ftp_port != g_ftp_port
                        || ftp_user != g_ftp_user || ftp_pass != g_ftp_pass || ftp_path != g_ftp_path) {
                        var map = {};
                        map.ftpip = ftp_ip;
                        map.ftpipport = ftp_port;
                        map.ftpuser = ftp_user;
                        map.ftppassword = ftp_pass;
                        map.ftppath = ftp_path;
                        $.get("../vb.htm", map, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_ftp();
                        });
                    }
                    if (g_device_type == 11) {
                        set_ftpenable();
                    }
                }

                var g_g3_enable = null;
                var g_g3_autostart = null;
                var g_g3_type = null;
                var g_g3_user = null;
                var g_g3_pass = null;
                var g_defaultasyncmap3g = null;

                function get_3g() {
                    $.get("../vb.htm?paratest=enable3g&paratest=autostart3g&paratest=g3type&paratest=g3user&paratest=g3pass&paratest=defaultasyncmap3g",
                    function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_g3_enable = parse_ajax_data(response[0]);
                        g_g3_autostart = parse_ajax_data(response[1]);
                        g_g3_type = parse_ajax_data(response[2]);
                        g_g3_user = parse_ajax_data(response[3]);
                        g_g3_pass = parse_ajax_data(response[4]);
                        g_defaultasyncmap3g = parse_ajax_data(response[5]);
                        $("#g3_enable").check_val(g_g3_enable == 1);
                        $("#g3_autostart").check_val(g_g3_autostart == 1);
                        $("#g3_type").select_val(g_g3_type);
                        $("#g3_user").val(g_g3_user);
                        $("#g3_pass").val(g_g3_pass);
                        $("#defaultasyncmap3g").check_val(g_defaultasyncmap3g == 1);
                        var is_default_auth = g_g3_user == "card" && g_g3_pass == "card";
                        $("#g3_default_auth").check_val(is_default_auth);
                    });
                }

                function set_3g() {
                    sfm_cur_obj = $(this);
                    var g3_enable = $("#g3_enable").check_val() ? "1" : "0";
                    var g3_autostart = $("#g3_autostart").check_val() ? "1" : "0";
                    var g3_type = $("#g3_type").select_val();
                    var g3_user = $("#g3_user").val();
                    var g3_pass = $("#g3_pass").val();
                    var defaultasyncmap3g = $("#defaultasyncmap3g").check_val() ? "1" : "0";
                    if (g3_user.length == 0 || g3_pass.length == 0) {
                        alert("用户名或密码不能为空！");
                        return;
                    }

                    if (g3_enable != g_g3_enable || g3_autostart != g_g3_autostart || g3_type != g_g3_type || g3_user != g_g3_user || g3_pass != g_g3_pass
                        || defaultasyncmap3g != g_defaultasyncmap3g) {
                        var map = {};
                        map.g3type = g3_type;
                        map.g3user = g3_user;
                        map.g3pass = g3_pass;
                        map.defaultasyncmap3g = defaultasyncmap3g;
                        map.autostart3g = g3_autostart;
                        map.enable3g = g3_enable;

                        $.get("../vb.htm", map, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_3g();
                        });
                    }
                }

                var g_support3g = null;
                function get_device_support3g() {
                    $.get("../vb.htm?paratest=support3g", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_support3g = parse_ajax_data(response[0]);
                        if (g_support3g == "0") {
                            $("#g3_enable").check_disabled(true);
                            $("#g3_autostart").check_disabled(true);
                            $("#g3_type").selectmenu('disable');
                            $("#g3_submit").attr("disabled", "disabled");
                        }
                        else {
                            $("#g3_submit").click(set_3g);
                        }
                    });
                }

                var g_g3_status = null;
                var g_g3ip = null;
                var g_upnp_status = null;
                var g_ddns_status = null;
                var g_openvpn_status = null;

                var check_g3_status_timer = 0;
                function check_g3_status() {
                    $.get("../vb.htm?paratest=status3g&paratest=g3ip&paratest=upnpstatus&paratest=ddnsstatus&paratest=openvpnstatus",
                    function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_g3_status = parse_ajax_data(response[0]);
                        g_g3ip = parse_ajax_data(response[1]);
                        g_upnp_status = parse_ajax_data(response[2]);
                        g_ddns_status = parse_ajax_data(response[3]);
                        g_openvpn_status = parse_ajax_data(response[4]);
                        if (g_g3_status == 1) {
                            $("#g3_status").css("color", "Green");
                            $("#g3_status").html("已连接");
                        }
                        else {
                            $("#g3_status").css("color", "Gray");
                            $("#g3_status").html("未连接");
                        }
                        if (g_g3ip != "0.0.0.0") {
                            $("#g3_ip").html(g_g3ip);
                        }
                        else {
                            $("#g3_ip").html("");
                        }
                        if (g_upnp_status == 1) {
                            $("#upnp_status").css("color", "Green");
                            $("#upnp_status").html("已连接");
                        }
                        else {
                            $("#upnp_status").css("color", "Gray");
                            $("#upnp_status").html("未连接");
                        }
                        if (g_ddns_status == 1) {
                            $("#ddns_status").css("color", "Green");
                            $("#ddns_status").html("已连接");
                        }
                        else {
                            $("#ddns_status").css("color", "Gray");
                            $("#ddns_status").html("未连接");
                        }
                        if (g_openvpn_status == 1) {
                            $("#openvpn_status").css("color", "Green");
                            $("#openvpn_status").html("已连接");
                        }
                        else {
                            $("#openvpn_status").css("color", "Gray");
                            $("#openvpn_status").html("未连接");
                        }
                    });
                }

                function check_g3_status_start() {
                    check_g3_status();
                    if (check_g3_status_timer == 0) {
                        check_g3_status_timer = setInterval(check_g3_status, 3500);
                    }
                }


                var g_ip2 = null;
                var g_netmask2 = null;
                function get_net2_config() {
                    $.get("../vb.htm?getnetip2&getnetmask2", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_ip2 = parse_ajax_data(response[0]);
                        g_netmask2 = parse_ajax_data(response[1]);
                        $("#input_netip2").val(g_ip2);
                        $("#input_netmask2").val(g_netmask2);
                    });
                }

                function set_net2_config() {
                    var map = {};
                    var send = false;
                    var ip2 = $("#input_netip2").val();
                    var netmask2 = $("#input_netmask2").val();

                    if (!test_ip(ip2) || !test_ip(netmask2)) {
                        alert("请输入正确的ip地址！");
                        return false;
                    }

                    if (test_ip_netmask(ip2, netmask2)) {
                        return false;
                    }

                    if (ip2 == g_ip) {
                        alert("设置的ip地址和主网口地址不能相同！");
                        return false;
                    }

                    //            if(g_support_onvif=="1" && test_ip_in_same_net(g_ip,g_nm,ip2)){
                    //                alert("网口1和网口2的地址不能在同一网段！");
                    //                return false;
                    //            }

                    if (ip2 != g_ip2 || netmask2 != g_netmask2) {
                        send = true;
                    }

                    map.netip2 = ip2;
                    map.netmask2 = netmask2;
                    if (send) {
                        $.get("../vb.htm", map, function (ajaxdata) {
                            //alert(ajaxdata);
                            default_ajax_handler(ajaxdata);
                            get_net2_config();
                        });
                    }
                }

                var g_have_eth1 = null;

                function init_ip2_config() {
                    $.get("../vb.htm?paratest=gethaveeth1", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        response = ajaxdata.split("\n");
                        g_have_eth1 = parse_ajax_data(response[0]);
                        if (g_have_eth1 == 0) {
                            $("#tabs-0 table").css("margin-left",'-40px');
                        }
                        else if (g_have_eth1 == 1) {
                            get_device_support_onvif();
                            if (g_support_onvif == "1") {
                                $("#lan_name1").html("主网口");
                                $("#lan_name2").html("扩展网口");
                                $("#net2_sep").show();
                                $("#tr_usblan_ip").show();
                                $("#tr_usblan_netmask").show();
                                $("#ip2_submit").click(set_net2_config);
                                get_net2_config();
                            }
                        }
                    });
                }
                var g_subject = null;
                var g_mailuser = null;
                var g_mailpw = null;
                var g_smtpadds = null;
                var g_mailrecver = null;

                function get_mail_config() {
                    $.get("../vb.htm?paratest=smtpsubject&paratest=smtpuser&paratest=smtppwd&paratest=smtpip&paratest=emailuser",
                   function (ajaxdata) {
                       if (precheck(ajaxdata)) {
                           return false;
                       }
                       response = ajaxdata.split("\n");
                       g_subject = parse_ajax_data(response[0]);
                       g_mailuser = parse_ajax_data(response[1]);
                       g_mailpw = parse_ajax_data(response[2]);
                       g_smtpadds = parse_ajax_data(response[3]);
                       g_mailrecver = parse_ajax_data(response[4]);

                       var recv = g_mailrecver.split(",");
                       $("#mailsubject").val(g_subject);
                       $("#sendermailname").val(g_mailuser);
                       $("#sendermailpw").val(g_mailpw);
                       $("#smtpadds").val(g_smtpadds);
                       $("#recvmail1").val(recv[0]);
                       $("#recvmail2").val(recv[1]);
                       $("#recvmail3").val(recv[2]);
                   });
                }

                function set_mail_config() {
                    sfm_cur_obj = $(this);
                    var subject = $("#mailsubject").val();
                    if ((subject.length == 0) || (subject.length > 32)) {
                        alert("标题设置错误！");
                        return 0;
                    }
                    var mailname = $("#sendermailname").val();
                    if ((mailname.length == 0) || (mailname.length > 32)) {
                        alert("发件人邮箱地址错误！");
                        return 0;
                    }
                    var mailpw = $("#sendermailpw").val();
                    if ((mailpw.length == 0) || (mailpw.length > 32)) {
                        alert("发件人邮箱密码错误！");
                        return 0;
                    }
                    var mailadds = $("#smtpadds").val();
                    if ((mailadds.length == 0) || (mailadds.length > 32)) {
                        alert("smtp服务器设置错误！");
                        return 0;
                    }

                    var mailrecver;
                    var mailrecver1 = $("#recvmail1").val();
                    var mailrecver2 = $("#recvmail2").val();
                    var mailrecver3 = $("#recvmail3").val();
                    var ishaverecver = 0;

                    if (mailrecver1.length != 0) {
                        ishaverecver = 1;
                        mailrecver = mailrecver1;
                    }
                    if (mailrecver2.length != 0) {
                        if (ishaverecver == 1)
                            mailrecver = mailrecver + ",";
                        mailrecver = mailrecver + mailrecver2;
                        ishaverecver = 1;
                    }
                    if (mailrecver3.length != 0) {
                        if (ishaverecver == 1)
                            mailrecver = mailrecver + ",";
                        mailrecver = mailrecver + mailrecver3;
                        ishaverecver = 1;
                    }

                    if (ishaverecver == 0) {
                        alert("没有收件人！");
                        return 0;
                    }

                    if (mailrecver.length > 250) {
                        alert("收件人过多！");
                        return 0;
                    }

                    if (subject != g_subject || mailname != g_mailuser
                        || mailpw != g_mailpw || mailadds != g_smtpadds || mailrecver != g_mailrecver) {
                        var map = {};
                        map.smtpsubject = subject;
                        map.smtpuser = mailname;
                        map.smtppwd = mailpw;
                        map.smtpip = mailadds;
                        map.emailuser = mailrecver;
                        $.get("../vb.htm", map, function (ajaxdata) {
                            default_ajax_handler(ajaxdata);
                            get_mail_config();
                        });
                    }
                }

                function cleanftpsendmsg() {
                    $("#ftp_test_msg").html("");
                }
                function cleanftpsendmsgloop() {
                    setInterval(cleanftpsendmsg, 30000);
                }

                function showftpmsg() {
                    $.get("../vb.htm?getdate", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if ("OK" != ajaxdata.slice(0, 2)) return false;
                        var slicestring = ajaxdata.slice(ajaxdata.indexOf("=") + 1, ajaxdata.length - 1);
                        var mydate = slicestring.split(" ");
                        var ftp_ip = $("#ftp_ip").val();
                        var ftp_port = $("#ftp_port").val();
                        var ftp_path = $("#ftp_path").val();
                        var name = $('#title').val();
                        var armip = $("#input_netip").val();
                        var test = "已发送测试文件 [FtpTest.txt] 至 ftp://" + ftp_ip + ":" + ftp_port + "/" + ftp_path + "/" + mydate[0] + "/" + name + "(" + armip + ")" + "/test/";
                        $("#ftp_test_msg").css("color", "Green");
                        $("#ftp_test_msg").html(test);
                    });
                }
                function ftp_test() {
                    $.get("../vb.htm?sendftptestfile", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }

                        var ftp_ip = $("#ftp_ip").val();
                        var ftp_port = $("#ftp_port").val();
                        var ftp_user = $("#ftp_user").val();
                        var ftp_pass = $("#ftp_pass").val();
                        var ftp_path = $("#ftp_path").val();

                        if (ftp_ip != g_ftp_ip || ftp_port != g_ftp_port
                            || ftp_user != g_ftp_user || ftp_pass != g_ftp_pass || ftp_path != g_ftp_path) {
                            alert("设置还未保存，请先保存配置后再发送测试文件.");
                            return false;
                        }
                        showftpmsg();
                    });
                }

                //取iframe的innerHTML
                function getIFrameContent(id) {
                    var hidden_fr = document.getElementById(id);
                    if (document.getElementById) {
                        if (hidden_fr && !window.opera) {
                            if (hidden_fr.contentDocument) {
                                return hidden_fr.contentDocument.body.innerHTML;
                            } else if (hidden_fr.Document) {
                                return hidden_fr.Document.body.innerHTML;
                            }
                        }
                    }
                }

                function on_iframe_loaded() {
                    if (loaded) {
                        return;
                    }
                    loaded = true;
                    var r;
                    var error = false;
                    try {
                        r = getIFrameContent("hidden_frame");
                    }
                    catch (error) {
                        error = true;
                    }
                    if (r.match(/All upload success/)) {
                        $("#prompt_text").css("color", "Green");
                        $("#prompt_text").html("证书上传成功！");
                    }
                    else {
                        $("#prompt_text").css("color", "Red");
                        $("#prompt_text").html("证书上传失败,请检查文件是否正确，或尝试重新上传！");
                    }
                }
                var iscrt = false;
                function fileChange(target) {
                    var path = $(target).val().split('\\').pop();
                    var type = path.substr(path.length - 3);
                    if(type != "crt"){
                        alert("请选择正确的证书文件，格式为.crt");
                        iscrt = false;
                    } else {
                        iscrt = true;
                    }
                }
                var last_ssid = "";
                var last_pwd = "";
                var last_safety_mode = "";
                var connect_count = 0;
                function set_wifi() {
                    connect_count++;
                    var wifi_ssid = $("#wifi_ssid").val();
                    var wifi_pwd = $("#wifi_pwd").val();
                    var safety_mode = $("#safety_mode").val();
                    var pwd_length = wifi_pwd.length;
                    if (last_ssid == wifi_ssid && last_pwd == wifi_pwd && last_safety_mode == safety_mode && $("#wifi_prompt_text").html() == "wifi已连接") {
                        return false;
                    }
                    last_ssid = wifi_ssid;
                    last_pwd = wifi_pwd;
                    last_safety_mode = safety_mode;
                    if (wifi_ssid == "") {
                        alert("SSID不能为空");
                        return false;
                    }
                    if (safety_mode != 0 && wifi_pwd == "") {
                        alert("加密模式下密码不能为空");
                        return false;
                    }
                    $("#wifi_prompt_text").css("color", "green");
                    $("#wifi_prompt_text").html("wifi连接中，请稍后...");
                    var data = safety_mode + ":" + pwd_length + ":" + wifi_pwd + ":" + wifi_ssid;
                    var base64 = Base64.encode(data);
                    $.get("../vb.htm?setwifi=" + base64, function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if (ajaxdata.substr(0, 2) == "OK") {
                            connect_count = 0;
                            $("#wifi_prompt_text").css("color", "green");
                            $("#wifi_prompt_text").html("wifi已连接");
                        } else if (ajaxdata.substr(0, 2) == "NG") {
                            if (connect_count < 3) {
                                set_wifi();
                                return;
                            }
                            connect_count = 0;
                            $("#wifi_prompt_text").css("color", "red");
                            var type = ajaxdata.substring(ajaxdata.indexOf("[") + 1, ajaxdata.indexOf("]"));
                            var err_info = "";
                            if (type == "-3") {
                                err_info = "没有搜索到此wifi信号，请重试！";
                            }  else if (type == "-4") {
                                err_info = "服务器配置wifi失败，请重试！";
                            } else if (type == "-5" || type == "-8") {
                                err_info = "密码格式错误，请重新输入！";
                            } else {
                                err_info = "密码或SSID不正确，请重试！";
                            }
                            $("#wifi_prompt_text").html(err_info);
                        }
                    });
                }
                function off_wifi() {
                    $.get("../vb.htm?setwifidisconnect", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if (ajaxdata.substr(0, 2) == "OK") {
                            $("#wifi_prompt_text").css("color", "red");
                            $("#wifi_prompt_text").html("wifi连接已断开");
                        }
                    });
                }
                var last_wifiip = "";
                function update_ip() {
                    var type = $("#ip_type").val();
                    var ip = $("#wifi_ip").val();
                    var netmask = $("#wifi_netmask").val();
                    var gateway = $("#wifi_gateway").val();
                    if(type == 1){
                        if (last_wifiip == ip) {
                            return;
                        }
                        last_wifiip = ip;
                        if (!test_ip(ip)) {
                            alert("请输入正确的IP地址！");
                            return;
                        }
                        if (!test_ip(netmask)) {
                            alert("请输入正确的子网掩码！");
                            return;
                        }
                        if (!test_ip(gateway)) {
                            alert("请输入正确的网关！");
                            return;
                        }
                        //if (g_ip) {
                        //    if (get_ip_field(g_ip) == get_ip_field(ip)) {
                        //        alert("有线IP和无线IP不能在同一网段");
                        //        return;
                        //    }
                        //}
                        if (get_ip_field(gateway) != get_ip_field(ip)) {
                            alert("IP和网关不在同一网段");
                            return;
                        }
                    } 
                    $.get("../vb.htm?setwifiip="+ type + ":" + ip + ":" + netmask + ":" + gateway, function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if (ajaxdata.substr(0, 2) == "OK") {
                            alert("ip修改成功！");
                            get_wifi_ip();
                        } else {
                            alert("ip修改失败，请重试！");
                        }
                    });
                    
                }
                function get_ip_field(ip) {
                    var netip_str1 = ip.substring(0, ip.lastIndexOf("."));
                    var netip_str = netip_str1.substring(netip_str1.lastIndexOf(".") + 1);
                    return netip_str;
                }
                function get_wifi_info() {
                    $.get("../vb.htm?getwifiinfo", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if (ajaxdata.substr(0, 2) == "OK") {
                            var info = ajaxdata.substr(ajaxdata.indexOf("=")+1);
                            var infos = info.split(";");
                            $("#safety_mode").select_val(infos[0]);
                            $("#wifi_pwd").val(infos[2]);
                            $("#wifi_ssid").val(infos[3]);

                            last_ssid = $("#wifi_ssid").val();
                            last_pwd = $("#wifi_pwd").val();
                            last_safety_mode = $("#safety_mode").val();
                        }
                    });
                }
                var get_wifi_ip_timer = null;
                function get_wifi_ip() {
                    $.get("../vb.htm?getwifiip", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        $("#wifi_ip").removeAttr("disabled");
                        $("#wifi_netmask").removeAttr("disabled");
                        $("#wifi_gateway").removeAttr("disabled");
                        if (ajaxdata.substr(0, 2) == "OK") {
                            var type_and_ip = ajaxdata.substr(ajaxdata.indexOf("=") + 1);
                            var arr = type_and_ip.split(":");
                            $("#ip_type").select_val(arr[0]);
                            $("#wifi_ip").val(arr[1]);
                            $("#wifi_netmask").val(arr[2]);
                            $("#wifi_gateway").val(arr[3]);
                            if (arr[0] == 0) {
                                $("#wifi_ip").attr("disabled", "disabled");
                                $("#wifi_netmask").attr("disabled", "disabled");
                                $("#wifi_gateway").attr("disabled", "disabled");
                            }
                            if (arr[0] == 0 && get_wifi_ip_timer == null) {
                                get_wifi_ip_timer = setInterval(function () {
                                    get_wifi_ip();
                                }, 5000);
                            }
                        } else {
                            $("#wifi_ip").val("");
                            $("#wifi_netmask").val("");
                            $("#wifi_gateway").val("");
                            if ($("#ip_type").select_val() == 0) {
                                $("#wifi_ip").attr("disabled", "disabled");
                                $("#wifi_netmask").attr("disabled", "disabled");
                                $("#wifi_gateway").attr("disabled", "disabled");
                            }
                        }
                    });
                }

                function get_wifi_list() {
                    $.get("../vb.htm?getwifilist", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if (ajaxdata.substr(0, 2) == "OK") {
                            init_wifi_list(ajaxdata.substring(ajaxdata.indexOf("=") + 1));
                        }
                    });
                }
                function init_wifi_list(data) {
                    var json_data = eval("(" + data + ")");
                    if (!json_data.wifilist) {
                        return false;
                    }
                    $("#wifiList").empty();
                    $("#loading_img").css("display","none");
                    var wifi_list = json_data.wifilist;
                    var li_str = "";
                    for (var i = 0; i < wifi_list.length; i++) {
                        var sign = 25;
                        if (wifi_list[i].quality > 90) {
                            sign = 100;
                        } else if (wifi_list[i].quality > 70) {
                            sign = 75;
                        } else if (wifi_list[i].quality > 40) {
                            sign = 50;
                        } 
                        li_str += '<li style="padding:0 10px;height:28px;line-height:28px;border:1px solid #fff"><img style="float:right;margin-top:6px;" src="../style/common/img/wifi' + sign + '.png" /><span>' + wifi_list[i].essid + '</span></li>';
                    }
                    $("#wifiList").append(li_str);
                    if (wifi_list.length > 6) {
                        $("#wifiList li").css("width", "302px");
                    } else {
                        $("#wifiList li").css("width", "320px");
                    }
                    $("#wifiList li").hover(function () {
                        $(this).css("border", "1px solid #ccc");
                    }, function () {
                        $(this).css("border", "1px solid #fff");
                    });
                    $("#wifiList li").click(function () {
                        var ssid = $(this).find("span").html();
                        $("#wifi_pwd").val("");
                        $("#wifi_ssid").val(ssid);
                        $("#safety_mode").select_val(0);
                    });
                }
                function check_wifi_sup() {
                    $.get("../vb.htm?paratest=gethavewifi", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if (ajaxdata.substr(ajaxdata.length - 2) == 0 || ajaxdata.substr(0,2) == "NG") {
                            return false;
                        }
                        $(".tabs_wifi_li").css("visibility","visible");
                        $("#tabs-8").css("visibility", "visible");
                        //get_wifi_ip();
                       
                        get_wifi_state();
                        get_wifi_list();
                        setInterval(function () {
                            get_wifi_list();
                        }, 10000);
                    });
                }
                function get_wifi_state() {
                    $.get("../vb.htm?getwificonnectstate", function (ajaxdata) {
                        if (precheck(ajaxdata)) {
                            return false;
                        }
                        if (ajaxdata.substr(0, 2) == "OK") {
                            var state = ajaxdata.substring(ajaxdata.indexOf("=") + 1);
                            if (parseInt(state) == 1) {
                                get_wifi_info();
                                $("#wifi_prompt_text").css("color", "green");
                                $("#wifi_prompt_text").html("wifi已连接");
                            } else {
                                $("#wifi_prompt_text").html("");
                            }
                        } 
                    });
                }
                $(function () {
                    if (g_style_time == "old") {
                        $("#file_input_btn").css("width", "70px");
                        $("#file_input_btn").css("font-size", "12px");
                        if (parent.cur_old_obj == "port") {
                            $("#http_li").remove();
                            $("#tabs-1").remove();
                        } else if (parent.cur_old_obj == "http") {
                            $("#net_tabs>ul>li").not("#http_li").remove();
                            $("#net_tabs>div").not("#tabs-1").remove();
                            $("#http_center tr:not(.small_title,.sfm_tr)").prepend("<td style='min-width:15px'></td>");
                            $(".small_title").show();
                            $("#indent_td").css("min-width","15px");
                        }
                    }
                    //jq-ui1.10支持tabs.tabs( "refresh" )，但selectmenu不支持1.10，所以只能现在创建
                    //必须等ajax完成才建立tab
                    create_tabs('#net_tabs');
                    //a little more work is done here, can be optimized
                    //$("#net_tabs input:text,input:password").addClass("text");
                    //$("#net_tabs button, input:submit").button();

                    init_selectmenu('#ddns_brand', 150, 150);
                    init_selectmenu('#g3_type', 120, 150);
                    $("#create_check_g3_default_auth").html(
                    '<td style="min-width:70px;">使用默认用户名和密码</td><td><input id="g3_default_auth" type="checkbox" /></td>');
                    $('#g3_default_auth').check_change(function (e, ui) {
                        if ($(this).check_val()) {
                            $("#g3_user").val("card");
                            $("#g3_pass").val("card");
                            $("#g3_user").attr("disabled", "disabled");
                            $("#g3_pass").attr("disabled", "disabled");
                        }
                        else {
                            $("#g3_user").val("");
                            $("#g3_pass").val("");
                            $("#g3_user").removeAttr("disabled");
                            $("#g3_pass").removeAttr("disabled");
                        }
                    });

                    //赛菲姆定制
                    if (g_style_time == "sfm") {
                        $(".basic").css("padding", "5px");
                        $(".basic").css("width", "90px");
                        $(".title_tr").remove();
                        $(".sfm_title_tr").show();
                        $(".center_log_items input").css("padding", "5px");
                        $(".center_log_items input").css("width", "70px");
                        $("#file_input_btn").css("width","130px");
                    } else {
                        $(".sfm_title_tr").remove();
                    }

                    $(".tabs_wifi_li").css("visibility", "hidden");
                    $("#tabs-8").css("visibility", "hidden");
                    $("#title_submit").click(set_title);
                    $("#ip_submit").click(set_sever_netconfig);
                    $("#http_port_submit").click(set_http_port);
                    $("#rtsp_port_submit").click(set_rtsp_port);
                    $("#ftp_test").click(ftp_test);
                    init_selectmenu('#centerserver_plate_content_level', 120, 150);
                    init_selectmenu('#httprepushnums_sel', 120, 150);
                    $("#openvpn_submit").click(set_openvpn);
                    $("#upnp_submit").click(set_upnp_portmap);
                    $("#ddns_submit").click(set_ddns);
                    $("#ftp_submit").click(set_ftp);
                    $("#mail_submit").click(set_mail_config);

                    var ie = checkIeVersion();
                    //if (g_style_time == "old") {
                    //    $("#file_input_btn").css("width", "70px");
                    //    $("#file_input_btn").css("font-size", "12px");
                    //}
                    //ie8 will not send request when file input is hidden!
                    if (g_style_time == "old" || g_style_time == "hrzx" || (ie.isIE && (ie.version <= 10 || (ie.emulatedversion != null && ie.emulatedversion <= 10)))) {
                        $("#file_input_btn").hide();
                        $("#file_name").hide();
                        $("#file_input").show();
                    }
                    $("#file_input").change(function () {
                        fileChange(this);
                    });
                    $("#file_input_btn").click(function () {
                        $("#file_input").click();
                        var path = $("#file_input").val().split('\\').pop();
                        $("#file_name").html(path);
                    });
                    $("#frmUpload").submit(function () {
                        if (!$("#file_input").val()) {
                            alert("请先选择证书！");
                            return false;
                        }else if(!iscrt){
                            alert("请选择正确的证书文件，格式为.crt");
                            return false;
                        }
                        else {
                            loaded = false;
                            $("#prompt_text").css("color", "Red");
                            $("#prompt_text").html("文件上传中，请稍后...");
                        }
                    });
                    $("#hidden_frame").on("load", on_iframe_loaded);

                    init_selectmenu('#safety_mode', 158, 150);
                    init_selectmenu('#ip_type', 158, 150);
                    $("#ip_type").on("selectmenuchange", function (event, ui) {
                        if ($(this).val() == 0) {
                            $("#wifi_ip").attr("disabled", "disabled");
                            $("#wifi_netmask").attr("disabled", "disabled");
                            $("#wifi_gateway").attr("disabled", "disabled");
                            if(get_wifi_ip_timer == null){
                                get_wifi_ip_timer = setInterval(function () {
                                    get_wifi_ip();
                                }, 5000);
                            }
                        } else {
                            $("#wifi_ip").removeAttr("disabled");
                            $("#wifi_netmask").removeAttr("disabled");
                            $("#wifi_gateway").removeAttr("disabled");
                            clearInterval(get_wifi_ip_timer);
                            get_wifi_ip_timer = null;
                        }
                    });
                    $("#wifi_submit").click(set_wifi);
                    $("#off_wifi").click(off_wifi);
                    //$("#wifi_ip_submit").click(update_ip);
                    $("#refresh_wifi").click(function () {
                        get_wifi_list();
                    });
                    if(g_style_time == "old"){
                        if (parent.cur_old_obj == "http") {
                            centerserver_tab.init();
                            return;
                        }
                    }
                    centerserver_tab.init();
                    check_wifi_sup();
                    //获得服务器名称
                    get_title();
                    get_server_netconfig();
                    init_ip2_config();
                    get_http_port();
                    get_rtsp_port();
                    get_upnp_portmap();
                    get_ddns();
                    get_ftp();
                    get_device_type();
                    if (g_device_type == 11) {
                        get_ftpenable();
                    }
                    else {
                        $("#ftp_enable_tr").hide();
                    }
                    get_3g();
                    get_openvpn();
                    check_g3_status_start();
                    get_device_support3g();
                    get_mail_config();
                    cleanftpsendmsgloop();
                });
            });
        });
    </script>


    <!--新的selectmenu有bug,当有ajax访问会失去焦点-->
    <!--<link type="text/css" href="../jq-ui/selectmenu/ui.selectmenu.css" rel="stylesheet" />

    <script src="../jq-ui/selectmenu/ui.selectmenu.js" type="text/javascript"></script>

    <script type="text/javascript" src="../js/base64.js"></script>
    <script src="../js/utf8.js" type="text/javascript"></script>

    <script src="../js/ajaxapi.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/devicesupport.js"></script>
    <script type="text/javascript" src="../js/style.js"></script>
    <script src="../js/custom-ui.js" type="text/javascript"></script>
    <script src="../js/testip.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/devicesupport.js"></script>-->

    <script type="text/javascript">

    </script>

</head>
<body>
    <div id="net_tabs" style="min-width: 900px;">
        <ul>
            <li><a href="#tabs-0">基本参数</a></li>
            <li id="http_li"><a href="#tabs-1">中心服务器</a></li>
            <li><a href="#tabs-2">upnp端口映射</a></li>
            <li><a href="#tabs-3">动态域名</a></li>
            <li><a href="#tabs-4">ftp</a></li>
            <li><a href="#tabs-5">mail</a></li>
            <li><a href="#tabs-6">3g</a></li>
            <li><a href="#tabs-7">vpn</a></li>
            <li class="tabs_wifi_li"><a href="#tabs-8">wifi</a></li>
        </ul>
        <div id="tabs-0">
            <table class="dummy" border="0">
                <tr class="title_tr">
                    <td style="min-width:40px;"></td>
                    <td style="min-width:70px;">
                        服务器名
                    </td>
                    <td>
                        <input id="title" type="text" size="20" />
                    </td>
                    <td>
                        <input id="title_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr class="title_tr">
                    <td style="min-height:20px"></td>
                </tr>
                <tr>
                    <td id="lan_name1"></td>
                    <td>
                        IP地址
                    </td>
                    <td>
                        <input id="input_netip" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        子网掩码
                    </td>
                    <td>
                        <input id="input_netmask" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        默认网关
                    </td>
                    <td>
                        <input id="input_gateway" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        DNS服务器
                    </td>
                    <td>
                        <input id="input_dnsip" type="text" value="" size="20" />
                    </td>
                    <td align="right">
                        <input class="basic" id="ip_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr id="net2_sep" style="display:none">
                    <td></td>
                    <td style="min-height:20px"></td>
                </tr>
                <tr id="tr_usblan_ip" style="display:none">
                    <td id="lan_name2"></td>
                    <td>
                        IP地址
                    </td>
                    <td>
                        <input id="input_netip2" type="text" size="20" />
                    </td>
                </tr>
                <tr id="tr_usblan_netmask" style="display:none">
                    <td></td>
                    <td>
                        子网掩码
                    </td>
                    <td>
                        <input id="input_netmask2" type="text" size="20" />
                    </td>
                    <td align="right">
                        <input class="basic" id="ip2_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td style="min-height:20px"></td>
                </tr>
                <tr class="sfm_title_tr"><td>&nbsp;</td></tr>
                <tr>
                    <td></td>
                    <td style="min-width:70px;">
                        http端口
                    </td>
                    <td>
                        <input id="http_port" type="text" size="20" />
                    </td>
                    <td>
                        <input class="basic" id="http_port_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td style="min-width:70px;">
                        rtsp端口
                    </td>
                    <td>
                        <input id="rtsp_port" type="text" size="20" />
                    </td>
                    <td>
                        <input class="basic" id="rtsp_port_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr class="sfm_title_tr"><td>&nbsp;</td></tr>
                <tr class="sfm_title_tr"><td>&nbsp;</td></tr>
                <tr class="sfm_title_tr">
                    <td style="min-width:40px;"></td>
                    <td style="min-width:70px;">
                        服务器名
                    </td>
                    <td>
                        <input id="title" type="text" size="20" />
                    </td>
                    <td>
                        <input class="basic" id="title_submit" type="submit" value="确定" />
                    </td>
                    <td style="display:none;" align="center" class="sfm_info"></td>
                </tr>
                <tr>
                    <td></td>
                    <td colspan="2" id="warning_text"></td>
                </tr>
            </table>
        </div>
        <div id="tabs-1">
            <table class="dummy" border="0" id="http_center">
                <tr class="small_title" style="display:none;font-weight:bold;">
                    <td colspan="3" class="title_td">基本配置</td>
                </tr>
                <tr>
                    <td style="min-width:100px">
                        服务器地址
                    </td>
                    <td>
                        <input id="centerserver_hostname" type="text" size="30" />
                    </td>
                    <td class="center_log_items" rowspan="9" colspan="8" style="display:none;max-width:300px;">
                        <p id="log_content" style="max-height:260px; overflow:auto;" />
                    </td>
                </tr>
                <tr>
                    <td style="min-width:100px">
                        备选服务器
                    </td>
                    <td>
                        <input id="centerserver_hostnamea_alt" type="text" size="30" />
                    </td>
                    <td id="hostnamea_alt_hint">多个地址用英文"；"分隔</td>
                </tr>
                <tr>
                    <td>
                        端口
                    </td>
                    <td>
                        <input id="centerserver_port" type="text" size="30" />
                    </td>
                </tr>
                <tr id="tr_centerserver_ssl_enable">
                    <td>
                        ssl连接
                    </td>
                    <td>
                        <input id="centerserver_enable_ssl" type="checkbox" />
                        <label for="centerserver_enable_ssl">开启</label>
                    </td>
                </tr>
                <tr id="tr_centerserver_ssl_port">
                    <td>
                        ssl端口
                    </td>
                    <td>
                        <input id="centerserver_ssl_port" type="text" size="30" />
                    </td>
                </tr>
                <tr id="tr_centerserver_timeout">
                    <td>
                        超时时间(s)
                    </td>
                    <td>
                        <input id="centerserver_timeout" type="text" size="30" />
                    </td>
                </tr>
                <tr class="small_title" style="display:none;font-weight:bold;">
                    <td colspan="3" class="title_td">推送配置</td>
                </tr>
                <tr id="tr_centerserver_enable_old" style="display:none">
                    <td>
                        设备注册
                    </td>
                    <td>
                        <input id="centerserver_enable_old" type="checkbox" />
                        <label for="centerserver_enable_old">开启</label>
                    </td>
                </tr>
                <tr id="tr_centerserver_device_reg_enable">
                    <td>
                        设备注册
                    </td>
                    <td>
                        <!--<input id="centerserver_device_reg_enable" type="checkbox" />
                        <label for="centerserver_device_reg_enable">开启</label>-->
                        <ul style="list-style:none;">
                            <li style="float:left;min-width:80px;">
                                <input id="centerserver_device_reg_enable1" type="radio" name="centerserver_device_reg_enable" />
                                <label for="centerserver_device_reg_enable1">取消心跳</label>
                            </li>
                            <li style="float:left;min-width:80px;">
                                <input id="centerserver_device_reg_enable2" type="radio" name="centerserver_device_reg_enable" />
                                <label for="centerserver_device_reg_enable2">普通心跳</label>
                            </li>
                            <li style="float:left;min-width:90px;">
                                <input id="centerserver_device_reg_enable3" type="radio" name="centerserver_device_reg_enable" />
                                <label for="centerserver_device_reg_enable3">comet轮询</label>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>
                        主服务器优先
                    </td>
                    <td>
                        <input id="http_poll_enable" type="checkbox" />
                        <label for="http_poll_enable">开启</label>
                    </td>
                </tr>
                <tr id="tr_centerserver_device_reg_uri">
                    <td>
                        地址
                    </td>
                    <td>
                        <input id="centerserver_device_reg_uri" type="text" size="30" />
                    </td>
                </tr>
                <tr id="tr_centerserver_plate_enable">
                    <td>
                        推送车牌识别结果
                    </td>
                    <td>
                        <input id="centerserver_plate_enable" type="checkbox" />
                        <label for="centerserver_plate_enable">开启</label>
                    </td>
                </tr>
                <tr id="tr_centerserver_plate_uri">
                    <td>
                        地址
                    </td>
                    <td>
                        <input id="centerserver_plate_uri" type="text" size="30" />
                    </td>
                </tr>
                <tr id="tr_centerserver_plate_content_level">
                    <td>
                        内容详细等级
                    </td>
                    <td>
                        <select id="centerserver_plate_content_level">
                            <option value="0">全部</option>
                            <option value="1">较详细</option>
                            <option value="2">较简略</option>
                            <option value="3">简略</option>
                        </select>
                    </td>
                </tr>
                <tr id="tr_centerserver_plate_send_image">
                    <td>
                        发送图片
                    </td>
                    <td>
                        <ul style="list-style:none">
                            <li style="float:left;margin-right:10px;min-width:100px;">
                                <input id="centerserver_plate_send_image" type="checkbox" />
                                <label for="centerserver_plate_send_image">发送大图片</label>
                            </li>
                            <li style="float:left;min-width:100px;">
                                <input id="centerserver_plate_send_small_image" type="checkbox" />
                                <label for="centerserver_plate_send_small_image">发送小图片</label>
                            </li>
                        </ul>
                    </td>
                </tr>
                <!--<tr id="tr_centerserver_plate_send_small_image">
                    <td>
                        发送小图片
                    </td>
                    <td>
                        <input id="centerserver_plate_send_small_image" type="checkbox" />
                        <label for="centerserver_plate_send_small_image">开启</label>
                    </td>
                </tr>-->
                <tr id="tr_centerserver_gioin_enable">
                    <td>
                        推送端口触发信息
                    </td>
                    <td>
                        <input id="centerserver_gioin_enable" type="checkbox" />
                        <label for="centerserver_gioin_enable">开启</label>
                    </td>
                </tr>
                <tr id="tr_centerserver_gioin_uri">
                    <td>
                        地址
                    </td>
                    <td>
                        <input id="centerserver_gioin_uri" type="text" size="30" />
                    </td>
                </tr>

                <!--<tr id="tr_centerserver_gioin_io">
                    <td>
                        推送端口
                    </td>
                    <td>
                        <ul id="io_ul">
                            <li style="float: left;list-style: none;margin-right:10px;">
                                <input type="checkbox" id="io1" />
                                <label for="io1">IO-OUT1</label>
                            </li>
                            <li style="float: left; list-style: none;margin-right:10px;">
                                <input type="checkbox" id="io2" />
                                <label for="io2">IO-OUT2</label>
                            </li>
                            <li style="float: left; list-style: none;margin-right:10px;">
                                <input type="checkbox" id="io3" />
                                <label for="io3">IO-OUT3</label>
                            </li>
                            <li style="float: left; list-style: none;">
                                <input type="checkbox" id="io4" />
                                <label for="io4">IO-OUT4</label>
                            </li>
                        </ul>
                    </td>
                </tr>-->



                <tr id="tr_centerserver_serial_enable">
                    <td>
                        推送串口数据
                    </td>
                    <td>
                        <input id="centerserver_serial_enable" type="checkbox" />
                        <label for="centerserver_serial_enable">开启</label>
                    </td>
                </tr>
                <tr id="tr_centerserver_serial_uri">
                    <td>
                        地址
                    </td>
                    <td>
                        <input id="centerserver_serial_uri" type="text" size="30" />
                    </td>
                </tr>
                <tr>
                    <td>
                        HTTP脱机检查
                    </td>
                    <td>
                        <input id="http_offline_enable" type="checkbox" />
                        <label for="http_offline_enable">开启</label>
                    </td>
                </tr>
                <tr>
                    <td>
                        重发次数
                    </td>
                    <td>
                        <select id="httprepushnums_sel">
                            <option value="0">不启用</option>
                            <option value="1">1次</option>
                            <option value="2">2次</option>
                            <option value="3">3次</option>
                            <option value="4">4次</option>
                        </select>
                    </td>
                </tr>
                <tr><td></td></tr>
                <tr>
                    <td align="right" colspan="2">
                        <input id="centerserver_submit" type="submit" value="确定" />
                    </td>
                    <!--<td align="right" style="display:none">
                        <input id="centerserver_view_log" type="submit" value="查看日志" />
                    </td>
                    <td class="center_log_items" style="display:none">
                        <input id="log_refresh" type="submit" value="刷新" />
                    </td>
                    <td class="center_log_items" style="display:none">
                        <input id="log_pre_page" type="submit" value="上页" />
                    </td>
                    <td class="center_log_items" style="display:none">
                        <input id="log_next_page" type="submit" value="下页" />
                    </td>
                    <td class="center_log_items" id="log_page_hint" style="display:none; min-width:60px; font-size:0.9em"></td>
                    <td class="center_log_items" style="display:none">
                        <input id="log_page_goto" type="text" size="5" />
                    </td>
                    <td class="center_log_items" style="display:none">
                        <input id="log_page_goto_sub" type="submit" value="跳转" />
                    </td>-->
                </tr>
                <tr class="sfm_tr">
                    <td style="display:none;" align="center" class="sfm_info"></td>
                </tr>
            </table>
        </div>
        <div id="tabs-2">
            <table class="dummy" border="0">
                <tr>
                    <td style="min-width:70px;">
                        开启upnp端口映射
                    </td>
                    <td>
                        <input id="upnp_enable" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td>
                        http映射端口
                    </td>
                    <td>
                        <input id="upnp_http_port" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        rtsp映射端口
                    </td>
                    <td>
                        <input id="upnp_rtst_port" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        连接状态：
                    </td>
                    <td id="upnp_status"></td>
                </tr>
                <tr><td></td></tr>
                <tr>
                    <td></td>
                    <td align="right">
                        <input id="upnp_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr>
                    <td style="display:none;padding:20px;" colspan="2" align="right" class="sfm_info"></td>
                </tr>
            </table>
        </div>
        <div id="tabs-3">
            <table class="dummy" border="0">
                <tr>
                    <td style="min-width:70px;">
                        开启自动域名注册
                    </td>
                    <td>
                        <input id="ddns_enable" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td>
                        ddns提供商
                    </td>
                    <td>
                        <select id="ddns_brand">
                            <option value="www.3322.net">www.3322.net</option>
                            <!--
                            <option>www.dnsexit.com</option>
                            <option>www.dyn.com</option>-->
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        域名
                    </td>
                    <td>
                        <input id="ddns_name" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        用户名
                    </td>
                    <td>
                        <input id="ddns_user" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        密码
                    </td>
                    <td>
                        <input id="ddns_pass" type="password" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        连接状态：
                    </td>
                    <td id="ddns_status"></td>
                </tr>
                <tr><td></td></tr>
                <tr>
                    <td></td>
                    <td align="right">
                        <input id="ddns_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr>
                    <td style="display:none;padding:20px;" colspan="2" align="right" class="sfm_info"></td>
                </tr>
            </table>
        </div>
        <div id="tabs-4">
            <table class="dummy" border="0">
                <tr id="ftp_enable_tr">
                    <td style="min-width:70px;">
                        开启FTP上传
                    </td>
                    <td>
                        <input id="ftp_enable" type="checkbox" size="20" />
                    </td>
                </tr>
                <tr>
                    <td style="min-width:70px;">
                        ftp地址
                    </td>
                    <td>
                        <input id="ftp_ip" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        端口
                    </td>
                    <td>
                        <input id="ftp_port" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        用户名
                    </td>
                    <td>
                        <input id="ftp_user" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        密码
                    </td>
                    <td>
                        <input id="ftp_pass" type="password" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        上传路径
                    </td>
                    <td>
                        <input id="ftp_path" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td id="ftp_test_msg"></td>
                </tr>
                <tr>
                    <td></td>
                    <td align="left">
                        <input id="ftp_submit" type="submit" value="确定" />
                        <input id="ftp_test" type="submit" value="发送测试" />
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td style="display:none;padding:20px;" class="sfm_info"></td>
                </tr>
            </table>
        </div>

        <div id="tabs-5">
            <table class="dummy" border="0">
                <tr>
                    <td>
                        邮件标题
                    </td>
                    <td>
                        <input id="mailsubject" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td style="min-width:70px;">
                        发件人邮箱
                    </td>
                    <td>
                        <input id="sendermailname" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        邮箱密码
                    </td>
                    <td>
                        <input id="sendermailpw" type="password" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        smtp服务器地址
                    </td>
                    <td>
                        <input id="smtpadds" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        收件人邮箱:
                    </td>
                </tr>
                <tr>
                    <td align="right">
                        1.
                    </td>
                    <td>
                        <input id="recvmail1" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td align="right">
                        2.
                    </td>
                    <td>
                        <input id="recvmail2" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td align="right">
                        3.
                    </td>
                    <td>
                        <input id="recvmail3" type="text" size="20" />
                    </td>
                </tr>
                <tr><td></td></tr>
                <tr>
                    <td></td>
                    <td align="right">
                        <input id="mail_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr>
                    <td style="display:none;padding:20px;" colspan="2" align="right" class="sfm_info"></td>
                </tr>
            </table>
        </div>
        <div id="tabs-6">
            <table class="dummy" border="0">
                <tr>
                    <td>
                        3g类型
                    </td>
                    <td>
                        <select id="g3_type">
                            <option>电信 cdma</option>
                            <option>联通 wcdma</option>
                        </select>
                    </td>
                </tr>
                <tr id="create_check_g3_default_auth"></tr>
                <tr>
                    <td>
                        用户名
                    </td>
                    <td>
                        <input id="g3_user" type="text" size="33" style="width:150px" />
                    </td>
                </tr>
                <tr>
                    <td>
                        密码
                    </td>
                    <td>
                        <input id="g3_pass" type="password" size="33" style="width:150px" />
                    </td>
                </tr>
                <tr>
                    <td style="min-width:70px;">
                        使用默认字符映射（default-asyncmap）
                    </td>
                    <td>
                        <input id="defaultasyncmap3g" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td style="min-width:70px;">
                        启用3g连接
                    </td>
                    <td>
                        <input id="g3_enable" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td style="min-width:70px;">
                        启动时自动连接
                    </td>
                    <td>
                        <input id="g3_autostart" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td>
                        连接状态：
                    </td>
                    <td id="g3_status"></td>
                </tr>
                <tr>
                    <td>
                        IP地址：
                    </td>
                    <td id="g3_ip"></td>
                </tr>
                <tr>
                    <td></td>
                    <td align="right">
                        <input id="g3_submit" type="submit" value="确定" />
                    </td>
                </tr>
                <tr>
                    <td style="display:none;padding:20px;" colspan="2" align="right" class="sfm_info"></td>
                </tr>
            </table>
        </div>
        <div id="tabs-7">
            <table class="dummy" border="0">
                <tr>
                    <td style="min-width:70px;">
                        启用openvpn连接
                    </td>
                    <td>
                        <input id="openvpn_enable" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td>
                        vpn服务器地址
                    </td>
                    <td>
                        <input id="openvpn_hostname" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        端口
                    </td>
                    <td>
                        <input id="openvpn_port" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        连接状态：
                    </td>
                    <td id="openvpn_status"></td>
                </tr>
                <tr>
                    <td>
                        选择本地证书
                    </td>
                    <td>
                        <form id="frmUpload" method="post" enctype="multipart/form-data" action="../cgi-bin/upload.cgi" target="hidden_frame">
                            <div id="file_name" style="width:160px;max-width:160px;display:inline-block"></div>
                            <input id="file_input_btn" type="button" value="浏览" />
                            <input id="file_input" type="file" name="file" style="display:none;height:20px;width:240px;" accept=".crt" />
                            <input type="submit" id="upload" value="上传" />
                        </form>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" id="prompt_text"></td>
                </tr>
                <tr>
                    <td></td>
                    <td align="right">
                        <input id="openvpn_submit" type="submit" value="确定" />
                    </td>
                    <td style="display:none;" class="sfm_info"></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td colspan="2">
                        <p>若点击连接后长时间处于<span style="color:gray;">未连接</span>状态，请检查以下情况：</p>
                        <p>&nbsp;</p>
                        <p>1、证书未上传</p>
                        <p>2、上传的证书有误</p>
                        <p>3、VPN 服务器未开启</p>
                        <p>4、VPN 服务器连接的 IP 或端口有误</p>
                        <p>5、启用 openvpn 连接选项未勾选</p>
                    </td>
                </tr>
            </table>
            <iframe name='hidden_frame' id="hidden_frame" style="visibility:hidden;height:10px"></iframe>
        </div>
        <div id="tabs-8">
            <table class="dummy" border="0">
                <tr>
                    <td>
                        SSID
                    </td>
                    <td>
                        <input id="wifi_ssid" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        密码
                    </td>
                    <td>
                        <input id="wifi_pwd" type="password" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        安全模式
                    </td>
                    <td><select id="safety_mode"><option value="0">无</option><option value="1">WEP</option><option value="2">WPA/WPA2</option></select></td>
                    <td>
                        <input id="wifi_submit" type="submit" value="连接" />
                        <input id="off_wifi" type="submit" value="断开" />
                    </td>
                </tr>
                <tr>
                    <td colspan="3" id="wifi_prompt_text"></td>
                </tr>
                <!--<tr>
                    <td>
                        获取方式
                    </td>
                    <td>
                        <select id="ip_type"><option value="0">自动获取IP</option><option value="1">手动设置IP</option></select>
                    </td>
                </tr>
                <tr>
                    <td>
                        IP地址
                    </td>
                    <td>
                        <input disabled id="wifi_ip" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        子网掩码
                    </td>
                    <td>
                        <input disabled id="wifi_netmask" type="text" size="20" />
                    </td>
                </tr>
                <tr>
                    <td>
                        默认网关
                    </td>
                    <td>
                        <input disabled id="wifi_gateway" type="text" size="20" />
                    </td>
                    <td>
                        <input id="wifi_ip_submit" type="submit" value="确认" />
                    </td>
                </tr>-->
                <tr>
                    <td colspan="2" id="wifi_ip_text"></td>
                </tr>
                <tr><td colspan="2">WIFI列表</td><td><input id="refresh_wifi" type="submit" value="刷新列表" /></td></tr>
                <tr>
                    <td colspan="3">
                        <div id="wifi_div" style="width:342px;height:180px;border:1px solid green;overflow:auto;position:relative;">
                            <ul id="wifiList" style="width:322px;list-style-type:none;font-size:12px"></ul>
                            <img id="loading_img" src="../style/old/org/img/loading3.gif" style="position:absolute;top:85px;left:162px;" />
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>
</html>
